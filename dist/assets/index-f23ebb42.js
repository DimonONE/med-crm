import{a as D,r as n,u as V,j as s,S as g,c as u,M as b,B as S,Q as f,P as M}from"./index-24cecf2c.js";import{a as R}from"./doctorApi-61e3c07c.js";import{U as y}from"./Checkbox-651ee817.js";import{f as G,u as H,g as J,C as U}from"./appointmentTableApi-0b50187c.js";import{e as L}from"./utils-045dd2ef.js";import"./styles.module-eea2a584.js";import{B as Q}from"./BackButton-93cd1b6a.js";import{F as q}from"./FileLoader-d13bd311.js";import{T as z}from"./TechInfo-32dd6e81.js";import"./useQuery-0902312d.js";import"./useBaseQuery-d3deef52.js";import"./styles.module-60436982.js";import"./Typography-da7e1d74.js";import"./extendSxProp-6a363c58.js";import"./Modal-59170fef.js";import"./DatePicker-74589845.js";/* empty css               */import"./Popper-f0f59e59.js";import"./lodash-168c37db.js";import"./useMutation-9b660a18.js";import"./CardsNavigate-8e194d1e.js";import"./styles.module-6aece55b.js";import"./services-ico-ca92e777.js";import"./styles.module-4a1edd24.js";import"./close-gray-ico-60493f19.js";import"./styles.module-f9591ad8.js";const K="_root_yma46_1",W="_backButton_yma46_6",X="_draggable_yma46_11",Y="_headBlock_yma46_24",Z="_lineBlock_yma46_28",$="_itemBlock_yma46_32",ee="_visitSummary_yma46_36",se="_name_yma46_45",te="_visitSummaryText_yma46_49",ae="_container_yma46_53",le="_statusBlock_yma46_60",oe="_submitBlock_yma46_61",me="_selectTemplate_yma46_67",ie="_submit_yma46_61",ne="_save_yma46_91",a={root:K,backButton:W,draggable:X,headBlock:Y,lineBlock:Z,itemBlock:$,visitSummary:ee,name:se,visitSummaryText:te,container:ae,statusBlock:le,submitBlock:oe,selectTemplate:me,submit:ie,save:ne};function Fe(){const c=D(),[k,B]=n.useState(1),[p,T]=n.useState(void 0),[o,I]=n.useState({completed:"",comment:"",plan:"",files:void 0}),C=V(),[h,N]=n.useState(void 0),[d,w]=n.useState([]),{data:_}=G(c.treatmentId),{data:i}=H(c.id),{data:x}=R(c.patientId),{mutate:E}=J(),j=[{value:1,label:"В процессе",type:"ACTIVE"},{value:2,label:"Закончено",type:"END"}],r=n.useMemo(()=>(i==null?void 0:i.subTemplates.map(({id:e,name:t})=>({value:e,label:t})))??[],[i]),A=({id:e,value:t})=>{const m=d.some(l=>l.id===e)?d.map(l=>l.id===e?{...l,answer:t}:l):[...d,{id:e,answer:t}];w(m)},P=()=>{const e=i==null?void 0:i.subTemplates.find(({id:t})=>t===h);T(e)},O=()=>{var m;if(Object.values(o).some(l=>l==="")){f("Краткое резюме посещения обязательно к заполнению!",{type:"warning"});return}if(!x)throw new Error("recordsPatient of undefined");const e=(m=x[x.length-1])==null?void 0:m.id;console.log("answers",d);const t={recordId:e,treatmentId:Number(c.treatmentId),subTemplateId:Number(h),completed:o.completed,comment:o.comment,plan:o.plan,blocks:JSON.stringify(d),...o!=null&&o.files?{files:o.files}:{}};E(t,{onSuccess:async l=>{const F=JSON.parse(l.data);console.log("/treatment/answer-create",F),f("Success!",{type:"success"}),C(M.reception.info(c.patientId,c.doctorId))},onSettled:()=>{},onError:l=>{f(L(l),{type:"error"})}})},v=(e,t)=>{I(m=>({...m,[e]:t}))};return n.useEffect(()=>{var e;N((e=r[0])==null?void 0:e.value)},[r]),s.jsxs("div",{className:a.root,children:[s.jsx(Q,{title:"Создание приема",link:"",className:a.backButton}),s.jsxs("div",{className:a.container,children:[s.jsxs("div",{className:a.statusBlock,children:[s.jsx("span",{children:"Статус лечения"}),s.jsx(g,{value:k,onChange:e=>{var t;return B((t=e==null?void 0:e.target)==null?void 0:t.value)},className:u("form-input buttons-header",a.selectTemplate),selectNavigate:!0,selectOptions:j,children:j.map(({label:e,value:t})=>s.jsx(b,{value:t,className:"select-link",children:e},t))})]}),s.jsx("div",{children:s.jsx(z,{techInfo:{fullName:_==null?void 0:_.patient.fullName,cardNumber:"",info:(i==null?void 0:i.techInfo)??""}})}),s.jsxs("div",{className:a.submitBlock,children:[r.length?s.jsx(g,{value:h??r[0].value,onChange:e=>{var t;return N((t=e==null?void 0:e.target)==null?void 0:t.value)},className:u("form-input buttons-header",a.selectTemplate),selectNavigate:!0,selectOptions:r,children:r.map(({label:e,value:t})=>s.jsx(b,{value:t,className:"select-link",onClick:()=>!1,children:e},t))}):null,s.jsx(S,{className:u(a.selectTemplate,a.submit),onClick:P,children:"Создать прием"})]}),p==null?void 0:p.bodyBlocks.map(e=>s.jsxs("div",{className:u(a.draggable),children:[s.jsx("div",{className:a.headBlock,children:e.name}),e.lineBlocks.map(t=>s.jsx("div",{className:a.itemBlock,children:t.blocks.map(m=>s.jsx("div",{children:n.createElement(U,{...m,key:m.lineId,type:"preview",isEditValue:!0,subTemplateId:e.subTemplateId,bodyBlockId:t.id,status:m.status,handleChange:l=>A(l)})},m.id))},t.id))]},e.id)),p&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:u(a.draggable),children:[s.jsx("div",{className:a.headBlock,children:"Краткое резюме посещения"}),s.jsxs("div",{className:a.visitSummary,children:[s.jsx("li",{className:a.name,children:"План: "}),s.jsx(y,{value:o.plan,name:"",onChange:e=>typeof e=="object"?v("plan",e.target.value):!1,className:a.visitSummaryText})]}),s.jsxs("div",{className:a.visitSummary,children:[s.jsx("li",{className:a.name,children:"Выполнили: "}),s.jsx(y,{value:o.completed,name:"",onChange:e=>typeof e=="object"?v("completed",e.target.value):!1,className:a.visitSummaryText})]}),s.jsxs("div",{className:a.visitSummary,children:[s.jsx("li",{className:a.name,children:"Комментарий: "}),s.jsx(y,{value:o.comment,name:"",onChange:e=>typeof e=="object"?v("comment",e.target.value):!1,className:a.visitSummaryText})]}),s.jsx("div",{className:a.visitSummary,children:s.jsx(q,{id:"pdf-files",title:"Загрузить",onChange:e=>v("files",e),onDownload:()=>{},onDelete:()=>{},className:a.visitSummaryFiles})})]}),s.jsx(S,{className:a.save,onClick:O,children:"Сохранить"})]})]})]})}export{Fe as default};
