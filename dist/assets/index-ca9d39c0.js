import{a as C,r as o,j as s,S as f,c as n,f as j,B as b,Q as h}from"./index-b7b75947.js";import{U as _}from"./Checkbox-a3d8c858.js";import{e as E,u as F,f as O,C as w}from"./appointmentTableApi-fec392a1.js";import{e as D}from"./utils-045dd2ef.js";import"./styles.module-eea2a584.js";import{B as V}from"./BackButton-b2e45c58.js";import{F as A}from"./FileLoader-47d88ffe.js";import{T as M}from"./TechInfo-fa3c3d70.js";import"./styles.module-60436982.js";import"./Typography-953e41f9.js";import"./extendSxProp-09d42ce9.js";import"./Modal-60b947f0.js";import"./DatePicker-7916f172.js";/* empty css               */import"./lodash-407105e9.js";import"./useMutation-3de9e6b6.js";import"./useBaseQuery-020bfd66.js";import"./useQuery-00968507.js";import"./CardsNavigate-18257e72.js";import"./styles.module-6aece55b.js";import"./services-ico-6c43c8eb.js";import"./styles.module-4a1edd24.js";import"./close-gray-ico-51fb0ef4.js";import"./styles.module-f9591ad8.js";const P="_root_yma46_1",R="_backButton_yma46_6",U="_draggable_yma46_11",G="_headBlock_yma46_24",H="_lineBlock_yma46_28",L="_itemBlock_yma46_32",Q="_visitSummary_yma46_36",q="_name_yma46_45",z="_visitSummaryText_yma46_49",J="_container_yma46_53",K="_statusBlock_yma46_60",W="_submitBlock_yma46_61",X="_selectTemplate_yma46_67",Y="_submit_yma46_61",Z="_save_yma46_91",t={root:P,backButton:R,draggable:U,headBlock:G,lineBlock:H,itemBlock:L,visitSummary:Q,name:q,visitSummaryText:z,container:J,statusBlock:K,submitBlock:W,selectTemplate:X,submit:Y,save:Z};function ge(){const p=C(),[N,g]=o.useState(1),[r,k]=o.useState(void 0),[l,B]=o.useState({completed:"",comment:"",plan:"",files:void 0}),[v,x]=o.useState(void 0),{data:u}=E(p.treatmentId),{data:m}=F(p.id),{mutate:S}=O();console.log("dataTreatment",u),console.log("data",m);const y=[{value:1,label:"В процессе",type:"ACTIVE"},{value:2,label:"Закончено"}],c=o.useMemo(()=>(m==null?void 0:m.subTemplates.map(({id:e,name:a})=>({value:e,label:a})))??[],[m]),T=()=>{const e=m==null?void 0:m.subTemplates.find(({id:a})=>a===v);k(e)},I=()=>{if(Object.values(l).some(a=>a==="")){h("Краткое резюме посещения обязательно к заполнению!",{type:"warning"});return}const e={recordId:9,treatmentId:Number(p.treatmentId),subTemplateId:Number(v),completed:l.completed,comment:l.comment,plan:l.plan,blocks:"",...l!=null&&l.files?{files:l.files}:{}};S(e,{onSuccess:async a=>{console.log("resp",a),h("Success!",{type:"success"})},onSettled:()=>{},onError:a=>{h(D(a),{type:"error"})}})},d=(e,a)=>{B(i=>({...i,[e]:a}))};return o.useEffect(()=>{var e;x((e=c[0])==null?void 0:e.value)},[c]),s.jsxs("div",{className:t.root,children:[s.jsx(V,{title:"Создание приема",link:"",className:t.backButton}),s.jsxs("div",{className:t.container,children:[s.jsxs("div",{className:t.statusBlock,children:[s.jsx("span",{children:"Статус лечения"}),s.jsx(f,{value:N,onChange:e=>{var a;return g((a=e==null?void 0:e.target)==null?void 0:a.value)},className:n("form-input buttons-header",t.selectTemplate),selectNavigate:!0,selectOptions:y,children:y.map(({label:e,value:a})=>s.jsx(j,{value:a,className:"select-link",onClick:()=>!1,children:e},a))})]}),s.jsx("div",{children:s.jsx(M,{techInfo:{fullName:u==null?void 0:u.patient.fullName,cardNumber:"",info:(m==null?void 0:m.techInfo)??""}})}),s.jsxs("div",{className:t.submitBlock,children:[c.length?s.jsx(f,{value:v??c[0].value,onChange:e=>{var a;return x((a=e==null?void 0:e.target)==null?void 0:a.value)},className:n("form-input buttons-header",t.selectTemplate),selectNavigate:!0,selectOptions:c,children:c.map(({label:e,value:a})=>s.jsx(j,{value:a,className:"select-link",onClick:()=>!1,children:e},a))}):null,s.jsx(b,{className:n(t.selectTemplate,t.submit),onClick:T,children:"Создать прием"})]}),r==null?void 0:r.bodyBlocks.map(e=>s.jsxs("div",{className:n(t.draggable),children:[s.jsx("div",{className:t.headBlock,children:e.name}),e.lineBlocks.map(a=>s.jsx("div",{className:t.itemBlock,children:a.blocks.map(i=>s.jsx("div",{children:o.createElement(w,{...i,key:i.lineId,type:"preview",subTemplateId:e.subTemplateId,bodyBlockId:a.id,status:i.status})},i.id))},a.id))]},e.id)),r&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:n(t.draggable),children:[s.jsx("div",{className:t.headBlock,children:"Краткое резюме посещения"}),s.jsxs("div",{className:t.visitSummary,children:[s.jsx("li",{className:t.name,children:"План: "}),s.jsx(_,{value:l.plan,name:"",onChange:e=>typeof e=="object"?d("plan",e.target.value):!1,className:t.visitSummaryText})]}),s.jsxs("div",{className:t.visitSummary,children:[s.jsx("li",{className:t.name,children:"Выполнили: "}),s.jsx(_,{value:l.completed,name:"",onChange:e=>typeof e=="object"?d("completed",e.target.value):!1,className:t.visitSummaryText})]}),s.jsxs("div",{className:t.visitSummary,children:[s.jsx("li",{className:t.name,children:"Комментарий: "}),s.jsx(_,{value:l.comment,name:"",onChange:e=>typeof e=="object"?d("comment",e.target.value):!1,className:t.visitSummaryText})]}),s.jsx("div",{className:t.visitSummary,children:s.jsx(A,{id:"pdf-files",title:"Загрузить",onChange:e=>d("files",e),onDownload:()=>{},onDelete:()=>{},className:t.visitSummaryFiles})})]}),s.jsx(b,{className:t.save,onClick:I,children:"Сохранить"})]})]})]})}export{ge as default};
