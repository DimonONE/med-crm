import{a as E,u as y,r as m,j as e,P as w,c as d,M as P,f as c,Q as j}from"./index-b7b75947.js";import"./styles.module-60436982.js";import{u as R,a as F,b as H,c as W,d as A,C as M}from"./appointmentTableApi-fec392a1.js";import{e as C}from"./utils-045dd2ef.js";import"./styles.module-eea2a584.js";import{H as O}from"./HeaderTemplate-3f19c997.js";import{S}from"./arrow-bottom-filter-f53bd9bf.js";import{B as G}from"./BackButton-b2e45c58.js";import{D as I}from"./CardsNavigate-18257e72.js";import{T as L}from"./TechInfo-fa3c3d70.js";import"./Checkbox-a3d8c858.js";import"./Typography-953e41f9.js";import"./extendSxProp-09d42ce9.js";import"./Modal-60b947f0.js";import"./DatePicker-7916f172.js";/* empty css               */import"./lodash-407105e9.js";import"./useMutation-3de9e6b6.js";import"./useBaseQuery-020bfd66.js";import"./useQuery-00968507.js";import"./services-ico-6c43c8eb.js";import"./styles.module-4a1edd24.js";import"./styles.module-6aece55b.js";const Q="_wrapper_188hu_1",$="_draggable_188hu_7",q="_reception_188hu_21",z="_headBlock_188hu_26",J="_blockWithPadding_188hu_27",K="_arrowBottom_188hu_36",U="_active_188hu_43",V="_lineBlock_188hu_47",X="_itemBlock_188hu_51",Y="_toggle_188hu_56",Z="_backButton_188hu_75",t={wrapper:Q,draggable:$,reception:q,headBlock:z,blockWithPadding:J,arrowBottom:K,active:U,lineBlock:V,itemBlock:X,toggle:Y,backButton:Z};function ee(p){const u=y(),[s,k]=m.useState(!1),{template:r,onCreateReception:T,onDeleteSubTemplate:v,onDeleteBlockTemplate:N}=p,{handleTemplates:b}=A(),f=o=>{const l=r.bodyBlocks.find(({id:g})=>g===o);if(!l)return;const i={...l,lineBlocks:l.lineBlocks.map(({blocks:g,...a})=>({...a,blockInfo:g}))};b([i]),u(w.template.create(r.id.toString()))},B=o=>e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>{T(),o()},children:"Создать прием"}),e.jsx(c,{onClick:()=>!1,children:"Редактировать"}),e.jsx(c,{disabled:!0,onClick:()=>!1,children:"Вставить"}),e.jsx(c,{disabled:!0,onClick:()=>!1,children:"Копировать"}),e.jsx(c,{onClick:()=>v(r.id),children:"Удалить прием"})]}),h=(o,l)=>e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:()=>{u(w.template.create(r.id.toString())),o()},children:"Создать блок"}),e.jsx(c,{disabled:!0,onClick:()=>!1,children:"Копировать"}),e.jsx(c,{disabled:!0,onClick:()=>!1,children:"Вставить"}),e.jsx(c,{onClick:()=>{f(l),o()},children:"Редактировать"}),e.jsx(c,{onClick:()=>l&&N(r.id,l),children:"Удалить"})]});return e.jsxs(e.Fragment,{children:[e.jsx(I,{menuItems:B,children:e.jsxs("button",{type:"button",className:d(t.draggable,t.reception),onClick:()=>k(o=>!o),children:[e.jsx("div",{className:t.headBlock,children:r.name}),e.jsx("div",{className:d(t.arrowBottom,{[t.active]:s}),children:e.jsx(S,{})})]})}),s&&e.jsxs("div",{children:[r.bodyBlocks.map(o=>e.jsxs("div",{className:d(t.draggable),children:[e.jsx("div",{className:t.headBlock,children:o.name}),e.jsx("div",{className:d(t.blockWithPadding,t.lineBlock),children:o.lineBlocks.map(l=>e.jsx("div",{className:t.itemBlock,children:l.blocks.map(i=>e.jsx("div",{children:m.createElement(M,{...i,key:i.lineId,type:"preview",subTemplateId:o.subTemplateId,bodyBlockId:l.id,status:i.status})},i.id))},l.id))}),e.jsx(I,{menuItems:l=>h(l,o.id),children:e.jsx("div",{className:t.arrowBottom,children:e.jsx(S,{})})})]},o.id)),r.bodyBlocks.length?null:e.jsx("div",{className:t.draggable,children:e.jsx(I,{menuItems:h,children:e.jsx("div",{className:t.arrowBottom,children:e.jsx(S,{})})})})]})]})}function ve(){const p=E(),u=y(),{data:s,isLoading:k,refetch:r}=R(p.subTemplateId),{mutate:T}=F(),{mutate:v}=H(),{mutate:N}=W(),[b,f]=m.useState(!1),[B,h]=m.useState([]),o=a=>{const n={name:`Прием №${a}`,templateId:Number(p.subTemplateId)};T(n,{onSuccess:()=>{r()},onError:x=>{j(C(x),{type:"error"})}})},l=a=>{N(a,{onSuccess:()=>{j("Success!",{type:"success"}),u(-1)},onError:n=>{j(C(n),{type:"error"})}})},i=a=>{v(a,{onSuccess:()=>{j("Success!",{type:"success"})},onError:n=>{j(C(n),{type:"error"})}})},g=(a,n)=>{const x=B.map(_=>_.id===a?{..._,bodyBlocks:_.bodyBlocks.filter(D=>D.id!==n)}:_);h(x)};return m.useEffect(()=>{!k&&!(s!=null&&s.subTemplates.length)&&o(1)},[k,s]),m.useEffect(()=>{const a=(s==null?void 0:s.subTemplates.sort((n,x)=>n.id-x.id))??[];h(a)},[s]),s!=null&&s.subTemplates?e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsxs("div",{className:t.wrapper,children:[e.jsx(G,{title:"",link:w.template.root,className:t.backButton}),e.jsx("div",{className:t.draggable,children:e.jsxs("div",{className:t.headBlock,children:[s.category,". ",s.name]})}),e.jsx(L,{techInfo:{info:s.techInfo}}),B.map(a=>e.jsxs("div",{children:[e.jsx(ee,{template:a,onCreateReception:()=>o(s.subTemplates.length+1),onDeleteSubTemplate:n=>i(n),onDeleteBlockTemplate:g}),e.jsx("div",{className:d(t.draggable,t.reception),children:e.jsx("div",{className:t.headBlock,children:"Краткое резюме посещения"})})]},a.id)),e.jsxs("div",{className:t.toggleBlock,children:[e.jsxs(P,{open:b,onClose:()=>f(!1),style:{top:-50,left:30},children:[e.jsx(c,{onClick:()=>!1,children:"Копировать"}),e.jsx(c,{onClick:()=>!1,children:"Редактировать"}),e.jsx(c,{onClick:()=>l(Number(p.subTemplateId)),children:"Удалить"})]}),e.jsx("button",{type:"button",onClick:()=>f(!0),className:d(t.toggle,{[t.active]:b}),children:"+"})]})]})]}):(u(-1),null)}export{ve as default};
