import{r as I,j as t,M as z,u as Z,F as ee,P as te,Q as Y,c as B,f as ne,R as oe,B as V,d as J,S as ae,$ as se,k as j}from"./index-24cecf2c.js";import{U as re,C as le}from"./Checkbox-651ee817.js";import"./styles.module-60436982.js";import{e as ce}from"./utils-045dd2ef.js";import"./styles.module-eea2a584.js";import{M as ie}from"./Modal-59170fef.js";import{D as de}from"./DatePicker-74589845.js";import{l as ue}from"./lodash-168c37db.js";import{u as $}from"./useMutation-9b660a18.js";import{u as A}from"./useQuery-0902312d.js";import{C as pe}from"./CardsNavigate-8e194d1e.js";import{S as me}from"./services-ico-ca92e777.js";var q=(e=>(e.ALL="all",e.PERIODONTICS="4",e.THERAPY="5",e.SURGERY="6",e.ORTHOPEDICS="7",e.OTHER="1",e))(q||{});const _e={1:"Другое",4:"Пародонтология",5:"Терапия",6:"Хирургия",7:"Ортопедия"},ke="_root_1modc_1",he={root:ke},fe=I.memo(({templateId:e,onDeleteTemplate:s})=>t.jsxs(t.Fragment,{children:[t.jsx(z,{onClick:()=>!1,children:"Просмотр"}),t.jsx(z,{onClick:()=>!1,children:"Копировать"}),t.jsx(z,{onClick:()=>!1,children:"Копировать все"}),t.jsx(z,{onClick:()=>!1,children:"Вставить"}),t.jsx(z,{onClick:()=>!1,children:"Переименовать"}),t.jsx(z,{onClick:()=>s(e),children:"Удалить"})]}));function Ft({id:e,onNavigate:s}){const{data:a,refetch:r}=Tt({offset:0,limit:100,category:e===q.ALL?"":_e[e]??""}),{mutate:c}=jt(),g=Z(),{checkUserRole:u}=ee(),_=u("superAdmin"),p=I.useMemo(()=>a!=null&&a.data.length?a.data.map(({id:h,name:x})=>({id:h,title:x??"",ico:t.jsx(me,{}),link:te.template.preview(e,h==null?void 0:h.toString())})):[],[a]),v=h=>{h.preventDefault(),h.stopPropagation(),alert("onCopy")},y=({link:h,id:x})=>{if(u("superAdmin")){g(h);return}s&&s(x)},k=I.useCallback(h=>{c(h,{onSuccess:()=>{Y("Success!",{type:"success"}),r()},onError:x=>{Y(ce(x),{type:"error"})}})},[c]),f=I.useCallback(h=>t.jsx(fe,{templateId:h,onDeleteTemplate:k}),[k]);return t.jsx(pe,{className:he.root,cards:p,hasCopy:_,onCopy:v,onClick:y,menuItems:_?f:void 0})}const we="_modalContent_kcoom_1",be="_headBlock_kcoom_1",Be="_inputBlock_kcoom_6",ge="_dropdownBlock_kcoom_15",ve="_dropdown_kcoom_15",ye="_buttonBlock_kcoom_30",Ce="_modal_kcoom_1",Wt={modalContent:we,headBlock:be,inputBlock:Be,dropdownBlock:ge,dropdown:ve,buttonBlock:ye,modal:Ce},Ie="_root_1kpbb_2",xe="_selectItem_1kpbb_7",Te="_circle_1kpbb_16",je="_right_1kpbb_45",H={root:Ie,selectItem:xe,circle:Te,right:je};function E(e){const[s,a]=I.useState(!1),r=I.useRef(null),{children:c,preview:g,className:u,positionParams:_,onDelete:p,onEdit:v,onUpdate:y,parentRef:k}=e,[f,h]=I.useState({element:null,offsetX:0}),x=ue.debounce(l=>{y&&(r.current.style.marginLeft="0px",y({sizeX:l}))},100),S=I.useCallback(()=>{let l=0;if(k){const w=Array.from(k.children);if(w.length>1)return l=w.slice(0,-1).reduce((D,i)=>D+i.offsetWidth,0),((k==null?void 0:k.offsetWidth)||0)-l}return l},[k])(),C=l=>{if(r.current){const w=r.current.getBoundingClientRect(),D=l.clientX,i=r.current.offsetWidth,o=_.minWidth??80,b=D-w.left<=20,M=w.right-D<=20;if(b||M){const F=Q=>{const K=Q.clientX-D;let R;b&&K>0?(R=Math.max(i-K,o),R>o&&(r.current.style.marginLeft=`${K}px`,x(R))):M&&(R=K<S?i+K:i+S),R&&R>o&&(r.current.style.width=`${R}px`,x(R))},G=()=>{document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",G)};document.addEventListener("mousemove",F),document.addEventListener("mouseup",G)}}},d=()=>{a(!0)},L=l=>{h(l)},O=l=>{var w;l.preventDefault(),L({element:l.currentTarget,offsetX:"clientX"in l?((w=r.current)==null?void 0:w.clientWidth)??0/2:0})},X=l=>{l.key==="Enter"?d():(l.key==="ContextMenu"||l.shiftKey&&l.key==="F10")&&O(l)},N=()=>{a(!1)},W=()=>{h({element:null,offsetX:0})},T={...(_==null?void 0:_.sizeX)&&{width:_.sizeX}};return g?t.jsx("div",{style:T,className:u,children:c}):t.jsxs("div",{className:H.root,style:T,children:[t.jsxs("div",{ref:r,onClick:d,tabIndex:0,onMouseDown:C,onBlur:N,onKeyDown:X,onContextMenu:O,role:"button",className:B(u,{[H.selectItem]:s}),children:[c,t.jsx("div",{className:H.right})]}),f.element&&t.jsxs(ne,{anchorEl:f.element,open:!!f.element,onClose:W,anchorPosition:{top:0,left:0},style:{marginLeft:f.offsetX/2,marginTop:-20},children:[v&&t.jsx(z,{onClick:()=>{v(),W()},children:"Редактировать"}),t.jsx(z,{onClick:()=>{p(),W()},children:"Удалить"})]})]})}const Ne="_defaultInput_ipw2e_2",Se="_selectItem_ipw2e_19",Oe="_createItem_ipw2e_20",Ee="_circle_ipw2e_29",ze="_right_ipw2e_63",Re="_lineContent_ipw2e_96",$e="_preview_ipw2e_104",De="_text_ipw2e_107",Pe="_bold_ipw2e_110",Le="_inputBlock_ipw2e_113",Xe="_marker_ipw2e_123",Me="_radioButtonsBlock_ipw2e_129",Fe="_radioBlock_ipw2e_129",We="_radioButton_ipw2e_129",Ke="_checked_ipw2e_138",Ae="_dropdown_ipw2e_155",Ve="_empty_ipw2e_163",He="_checkbox_ipw2e_167",Ue="_modalDropdown_ipw2e_174",Ge="_headBlock_ipw2e_174",Ye="_deleteButton_ipw2e_184",Je="_createVariable_ipw2e_195",qe="_createVariablePlus_ipw2e_203",Qe="_buttonBlock_ipw2e_214",Ze="_modal_ipw2e_174",n={defaultInput:Ne,selectItem:Se,createItem:Oe,circle:Ee,right:ze,lineContent:Re,preview:$e,text:De,bold:Pe,inputBlock:Le,marker:Xe,radioButtonsBlock:Me,radioBlock:Fe,radioButton:We,checked:Ke,dropdown:Ae,empty:Ve,checkbox:He,modalDropdown:Ue,headBlock:Ge,deleteButton:Ye,createVariable:Je,createVariablePlus:qe,buttonBlock:Qe,modal:Ze},Kt=oe.memo(e=>{const{onCurrentBlockInfo:s,onToggleVisibility:a,updateTemplatesLineItem:r,updateCurrentBlock:c}=et(),g=I.useRef(null),[u,_]=I.useState(""),[p,v]=I.useState(!1),[y,k]=I.useState(!1),[f,h]=I.useState([{id:0,value:-1,label:""}]),{subTemplateId:x,bodyBlockId:P,lineId:S,status:C,type:d="create",isEditValue:L=!1,value:O,handleChange:X,...N}=e,W=()=>{a(!0),s(x,P,S)},T=i=>{if(!L)return;const o={value:i.toString(),...C==="DROPDOWN"&&{value:JSON.stringify(f)},...C==="CHECK_BOX"&&{value:JSON.stringify({value:i.toString(),isChecked:p})}};_(i),c(x,P,S,o),X&&X({id:e.id??S,value:o.value})},l=()=>{r(x,P,S)},w=i=>{c(x,P,S,i)};I.useEffect(()=>{var i;if(O&&_(e.answer??O),O&&C==="DROPDOWN"){const o=JSON.parse(O??"");h(o);const b=e.answer&&JSON.parse(e.answer);_((b==null?void 0:b.value)??((i=o[0])==null?void 0:i.value))}if(O&&C==="CHECK_BOX"){const o=d!=="preview"?u:typeof u=="string"&&JSON.parse(e.answer||O||"{}");v(o.isChecked)}},[]),I.useEffect(()=>{if(C==="CHECK_BOX"){const i=JSON.parse(O||'{"value": ""}'),o={value:JSON.stringify({value:i.value,isChecked:p})};c(x,P,S,o),X&&X({id:e.id??S,value:o.value})}},[p]);const D=()=>{var i;switch(!0){case C==="TEXT":return t.jsx(E,{parentRef:e.parentRef,positionParams:N,preview:d==="preview",onUpdate:w,onDelete:l,className:B(n.lineContent,{[n.preview]:d==="preview"}),children:t.jsx("div",{className:n.inputBlock,children:t.jsx("input",{readOnly:d==="preview",className:B(n.defaultInput,n.text),value:u,onChange:o=>T(o.target.value)})})});case C==="BOLD_TEXT":return t.jsx(E,{parentRef:e.parentRef,positionParams:N,preview:d==="preview",onUpdate:w,onDelete:l,className:B(n.lineContent,{[n.preview]:d==="preview"}),children:t.jsx("div",{className:n.inputBlock,children:t.jsx("input",{readOnly:d==="preview",className:B(n.defaultInput,n.bold),value:u,onChange:o=>T(o.target.value)})})});case C==="POINT_TEXT":return t.jsx(E,{parentRef:e.parentRef,positionParams:N,preview:d==="preview",onUpdate:w,onDelete:l,className:B(n.lineContent,n.marker,{[n.preview]:d==="preview"}),children:t.jsx("div",{className:n.inputBlock,children:t.jsx("input",{readOnly:d==="preview",className:B(n.defaultInput),value:u,onChange:o=>T(o.target.value)})})});case C==="DROPDOWN":return t.jsx(E,{parentRef:e.parentRef,positionParams:{...N,minWidth:90},onUpdate:w,preview:d==="preview",onEdit:()=>k(!0),onDelete:l,className:B(n.lineContent,{[n.preview]:d==="preview"}),children:t.jsx(ae,{value:u||-1,onChange:o=>T(o.target.value),className:n.dropdown,selectNavigate:!0,selectOptions:f,children:f.map(({label:o,value:b})=>t.jsx(z,{value:b,className:"select-link",children:o},b))})});case C==="CHECK_BOX":{const o=d!=="preview"?u:((i=typeof u=="string"&&JSON.parse(u||"{}"))==null?void 0:i.value)??"";return t.jsx(E,{parentRef:e.parentRef,positionParams:N,onUpdate:w,preview:d==="preview",onDelete:l,className:B(n.lineContent,{[n.preview]:d==="preview"}),children:t.jsx(le,{className:n.checkbox,checked:p,onChange:()=>L&&v(b=>!b),children:t.jsx("input",{readOnly:d==="preview",placeholder:"Ваше значение",className:B(n.defaultInput,n.text),value:o,onChange:b=>T(b.target.value)})})})}case C==="RADIO_BOX":return t.jsx(E,{parentRef:e.parentRef,positionParams:{...N,minWidth:170},onUpdate:w,preview:d==="preview",onDelete:l,className:B(n.lineContent,n.radioButtonsBlock,{[n.preview]:d==="preview"}),children:t.jsxs(t.Fragment,{children:[t.jsxs("button",{type:"button",onClick:()=>T("Yes"),className:B(n.lineContent,n.radioBlock),children:[t.jsx("span",{className:B(n.radioButton,{[n.checked]:u==="Yes"})}),"Да"]}),t.jsxs("button",{type:"button",onClick:()=>T("No"),className:B(n.lineContent,n.radioBlock),children:[t.jsx("span",{className:B(n.radioButton,{[n.checked]:u!=="Yes"})}),"Нет"]})]})});case C==="DATE":return t.jsx(E,{parentRef:e.parentRef,positionParams:{...N,minWidth:170},onUpdate:w,preview:d==="preview",onDelete:l,className:B(n.lineContent,{[n.preview]:d==="preview"}),children:t.jsx(de,{sx:{".MuiInputBase-root.MuiOutlinedInput-root":{width:"150px",height:"42px",padding:"0 20px",maxWidth:"none",background:"#CBECFF",borderRadius:"10px",border:"1px solid #0E5F8C",fontSize:"14px",color:"#0E5F8C"},".MuiInputBase-root .MuiButtonBase-root.MuiIconButton-root":{color:"#0E5F8C"}},value:J(u),onChange:o=>o&&T(J(o).toISOString()),readOnly:!L})});case C==="EMPTY":return t.jsx(E,{parentRef:e.parentRef,positionParams:N,onUpdate:w,preview:d==="preview",onDelete:l,className:B(n.lineContent,n.empty),children:t.jsx("p",{children:d==="create"?"Пустое место":""})});case C==="WRITE_TEXT":return t.jsx(E,{parentRef:e.parentRef,positionParams:{...N,minWidth:200},onUpdate:w,preview:d==="preview",onDelete:l,className:B(n.lineContent),children:t.jsx(re,{value:u.toString(),name:"",onChange:o=>typeof o=="object"?T(o.target.value):"",readOnly:!L})});default:return t.jsxs("div",{ref:g,onClick:W,tabIndex:0,onKeyDown:()=>!1,role:"button",className:B(n.lineContent,n.createItem),children:[t.jsx("div",{className:n.circle,children:" + "}),t.jsx("div",{className:n.right})]})}};return t.jsxs(t.Fragment,{children:[D(),t.jsx(ie,{isOpen:y,type:"custom",onSuccess:()=>k(!1),onClose:()=>k(!1),className:n.modal,children:t.jsxs("div",{className:n.modalDropdown,children:[t.jsx("div",{className:n.headBlock,children:"Дропдаун"}),f.map(({id:i})=>{var o;return t.jsxs("div",{className:n.inputBlock,children:[t.jsx("input",{value:(o=f.find(({id:b})=>i===b))==null?void 0:o.label,onChange:b=>h(M=>M.map(F=>i===F.id?{...F,label:b.target.value}:F)),type:"text",placeholder:f.length===1?"Первый вариант по умолчанию":"Введите вариант"}),t.jsx("button",{type:"button",className:n.deleteButton,disabled:f.length===1,onClick:()=>h(b=>b.filter(({id:M})=>i!==M)),children:"x"})]},i)}),t.jsxs(V,{className:n.createVariable,onClick:()=>h(i=>[...i,{id:i.length+1,value:i.length+1,label:""}]),type:"button",color:"primary-reverse",children:[t.jsx("div",{className:n.createVariablePlus,children:"+"}),"Создать вариант"]}),t.jsxs("div",{className:n.buttonBlock,children:[t.jsx(V,{className:n.submit,type:"submit",color:"secondary",onClick:()=>{l(),k(!1)},children:"Назад"}),t.jsx(V,{className:n.submit,type:"submit",color:"primary",onClick:()=>{w({value:JSON.stringify(f)}),k(!1)},children:"Сохранить"})]})]})})]})}),U=(e,s,a)=>{e(r=>({templates:r.templates.map(c=>c.subTemplateId===s?a(c):c)}))},et=se((e,s)=>({toggleVisibility:!1,selectTemplateItem:"",currentBlockInfo:null,templates:[{name:"",positionId:0,subTemplateId:0,lineBlocks:[{positionId:0,bodyBlockId:0,blockInfo:[]}]}],handleTemplatesTitle:(a,r)=>{e(c=>({templates:c.templates.map(g=>g.subTemplateId===a?{...g,name:r}:g)}))},addTemplatesLine:a=>{U(e,a,r=>{const c=r.lineBlocks.length,g={positionId:c,bodyBlockId:c,blockInfo:[]};return{...r,lineBlocks:[...r.lineBlocks,g]}})},updateTemplatesLine:(a,r)=>{U(e,a,c=>({...c,lineBlocks:r}))},onToggleVisibility:a=>{e({toggleVisibility:a,currentBlockInfo:null})},handleTemplates:a=>{e({templates:a})},onCurrentBlockInfo:(a,r,c)=>{e({currentBlockInfo:{subTemplateId:a,bodyBlockId:r,lineId:c}})},updateTemplatesLineItem:(a,r,c)=>{const{templates:g}=s(),u=g.map(_=>{if(_.subTemplateId!==a)return _;const p=_.lineBlocks.map(v=>{if(v.bodyBlockId!==r)return v;const y=v.blockInfo.filter(({lineId:k})=>k!==c);return{...v,blockInfo:y}});return{..._,lineBlocks:p}});e({templates:u})},addCurrentBlock:a=>{const{currentBlockInfo:r}=s();if(!r)return;const{subTemplateId:c,bodyBlockId:g,lineId:u}=r;U(e,c,_=>({..._,lineBlocks:_.lineBlocks.map(p=>{if(p.bodyBlockId===g){if(p.blockInfo.length===0)return{...p,blockInfo:[{lineId:0,positionId:0,sizeX:0,sizeY:0,space:0,status:a,value:""},{lineId:1,positionId:1,sizeX:0,sizeY:0,space:0,status:"default",value:""}]};const v=p.blockInfo.length+2;return{...p,blockInfo:[...p.blockInfo.map(y=>{if(y.lineId===u){const k=p.blockInfo.length+1;return{lineId:k,positionId:k,sizeX:0,sizeY:0,space:0,status:a,value:""}}return y}),{lineId:v,positionId:v,sizeX:0,sizeY:0,space:0,status:"default",value:""}]}}return p})})),e({toggleVisibility:!1,currentBlockInfo:null})},updateCurrentBlock:(a,r,c,g)=>{const{templates:u}=s(),_=u.map(p=>{if(p.subTemplateId!==a)return p;const v=p.lineBlocks.map(y=>{if(y.bodyBlockId!==r)return y;const k=y.blockInfo.map(f=>f.lineId===c?{...f,...g}:f);return{...y,blockInfo:k}});return{...p,lineBlocks:v}});e({templates:_})}})),tt="_wrapper_k08z0_2",nt="_draggable_k08z0_8",ot="_headBlock_k08z0_19",at="_blockWithPadding_k08z0_20",st="_defaultInput_k08z0_30",rt="_dragHandleLeft_k08z0_47",lt="_contentBlockDraggable_k08z0_48",ct="_dragHandleRight_k08z0_59",it="_show_k08z0_73",dt="_createLineBlock_k08z0_77",ut="_createLine_k08z0_77",pt="_text_k08z0_92",mt="_contentBlock_k08z0_48",_t="_lineContent_k08z0_105",kt="_bold_k08z0_116",ht="_list_k08z0_119",ft="_inputBlock_k08z0_119",wt="_radioBlock_k08z0_125",bt="_radioButton_k08z0_125",Bt="_checked_k08z0_134",gt="_dropdown_k08z0_151",vt="_empty_k08z0_159",yt="_selectItem_k08z0_163",Ct="_createItem_k08z0_164",It="_circle_k08z0_173",xt="_right_k08z0_207",At={wrapper:tt,draggable:nt,headBlock:ot,blockWithPadding:at,defaultInput:st,dragHandleLeft:rt,contentBlockDraggable:lt,dragHandleRight:ct,show:it,createLineBlock:dt,createLine:ut,text:pt,contentBlock:mt,lineContent:_t,bold:kt,list:ht,inputBlock:ft,radioBlock:wt,radioButton:bt,checked:Bt,dropdown:gt,empty:vt,selectItem:yt,createItem:Ct,circle:It,right:xt},m={root:["appointment-table"],templateGetAll:e=>[...m.root,`template-get-all-${e}`],deleteTemplate:()=>[...m.root,"template-delete-template"],deleteSubTemplate:()=>[...m.root,"template-delete-sub-template"],templateGetOne:e=>[...m.root,`template-get-one-${e}`],createUpdateBodyBlock:()=>[...m.root,"create-update-body-block"],createTemplate:()=>[...m.root,"create-template"],createSubTemplate:()=>[...m.root,"create-sub-template"],treatment:(e,s)=>[...m.root,`treatment-treatment-get-${e}-${s}`],treatmentId:()=>[...m.root,"treatment-treatment-get-by-id"],treatmentCreate:()=>[...m.root,"treatment-treatment-create"],treatmentUpdate:()=>[...m.root,"treatment-treatment-update"],treatmentAnswerCreate:()=>[...m.root,"treatment-answer-create"]};function Vt(){return $({mutationKey:m.createUpdateBodyBlock(),mutationFn:async e=>(await j({url:"/template/create-update-body-block",method:"POST",data:e})).data})}function Ht(){return $({mutationKey:m.createTemplate(),mutationFn:async e=>(await j({url:"/template/create-template",method:"POST",data:e})).data})}function Ut(){return $({mutationKey:m.createSubTemplate(),mutationFn:async e=>(await j({url:"/template/create-sub-template",method:"POST",data:e})).data})}function Gt(e){return A({queryKey:m.templateGetOne(e),queryFn:async()=>(await j({url:`/template/get-one/${e}`,method:"GET"})).data})}function Tt({offset:e,limit:s,category:a}){return A({queryKey:m.templateGetAll(a),queryFn:async()=>(await j({url:"/template/get-all",method:"GET",params:{offset:e,limit:s,category:a}})).data})}function jt(){return $({mutationKey:m.deleteTemplate(),mutationFn:async e=>(await j({url:`/template/delete-template/${e}`,method:"DELETE"})).data})}function Yt(){return $({mutationKey:m.deleteSubTemplate(),mutationFn:async e=>(await j({url:`/template/delete-sub-template/${e}`,method:"DELETE"})).data})}function Jt(e){return A({queryKey:m.treatment(e.patientId,e.category??""),queryFn:async()=>(await j({url:"/treatment/treatment-get",method:"GET",params:e})).data})}function qt(e){return A({queryKey:m.treatmentId(),queryFn:async()=>{const s=await j({url:`/treatment/treatment-get-by-id/${e}`,method:"GET"});return s==null?void 0:s.data[0]}})}function Qt(){return $({mutationKey:m.treatmentCreate(),mutationFn:async e=>(await j({url:"/treatment/treatment-create",method:"POST",data:e})).data})}function Zt(){return $({mutationKey:m.treatmentCreate(),mutationFn:async e=>(await j({url:"/treatment/treatment-update",method:"POST",data:e})).data})}function en(){return $({mutationKey:m.treatmentCreate(),mutationFn:async e=>(await j({url:"/treatment/answer-create",method:"POST",data:e})).data})}export{Kt as C,_e as R,Ft as T,Ut as a,Yt as b,jt as c,Vt as d,et as e,qt as f,en as g,Zt as h,Ht as i,Qt as j,q as k,At as l,Tt as m,Jt as n,Wt as s,Gt as u};
