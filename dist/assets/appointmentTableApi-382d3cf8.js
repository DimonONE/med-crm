import{r as I,j as t,M as z,u as Z,F as ee,P as te,Q as Y,c as B,f as ne,R as oe,B as V,d as J,S as ae,$ as se,k as T}from"./index-3da5cc6b.js";import{U as re,C as le}from"./Checkbox-d96d046f.js";import"./styles.module-60436982.js";import{e as ce}from"./utils-045dd2ef.js";import"./styles.module-eea2a584.js";import{M as ie}from"./Modal-7f660902.js";import{D as de}from"./DatePicker-635a1657.js";import{l as ue}from"./lodash-38bb2507.js";import{u as R}from"./useMutation-39d089a9.js";import{u as A}from"./useQuery-280492f8.js";import{C as pe}from"./CardsNavigate-3a1062af.js";import{S as me}from"./services-ico-f14428e8.js";var q=(e=>(e.ALL="all",e.PERIODONTICS="4",e.THERAPY="5",e.SURGERY="6",e.ORTHOPEDICS="7",e.OTHER="1",e))(q||{});const _e={1:"Другое",4:"Пародонтология",5:"Терапия",6:"Хирургия",7:"Ортопедия"},ke="_root_1modc_1",he={root:ke},fe=I.memo(({templateId:e,onDeleteTemplate:s})=>t.jsxs(t.Fragment,{children:[t.jsx(z,{onClick:()=>!1,children:"Просмотр"}),t.jsx(z,{onClick:()=>!1,children:"Копировать"}),t.jsx(z,{onClick:()=>!1,children:"Копировать все"}),t.jsx(z,{onClick:()=>!1,children:"Вставить"}),t.jsx(z,{onClick:()=>!1,children:"Переименовать"}),t.jsx(z,{onClick:()=>s(e),children:"Удалить"})]}));function Mt({id:e,onNavigate:s}){const{data:a,refetch:r}=Tt({offset:0,limit:100,category:e===q.ALL?"":_e[e]??""}),{mutate:c}=jt(),g=Z(),{checkUserRole:d}=ee(),_=d("superAdmin"),m=I.useMemo(()=>a!=null&&a.data.length?a.data.map(({id:h,name:x})=>({id:h,title:x??"",ico:t.jsx(me,{}),link:te.template.preview(e,h==null?void 0:h.toString())})):[],[a]),y=h=>{h.preventDefault(),h.stopPropagation(),alert("onCopy")},v=({link:h,id:x})=>{if(d("superAdmin")){g(h);return}s&&s(x)},k=I.useCallback(h=>{c(h,{onSuccess:()=>{Y("Success!",{type:"success"}),r()},onError:x=>{Y(ce(x),{type:"error"})}})},[c]),b=I.useCallback(h=>t.jsx(fe,{templateId:h,onDeleteTemplate:k}),[k]);return t.jsx(pe,{className:he.root,cards:m,hasCopy:_,onCopy:y,onClick:v,menuItems:_?b:void 0})}const be="_modalContent_kcoom_1",we="_headBlock_kcoom_1",Be="_inputBlock_kcoom_6",ge="_dropdownBlock_kcoom_15",ye="_dropdown_kcoom_15",ve="_buttonBlock_kcoom_30",Ce="_modal_kcoom_1",Kt={modalContent:be,headBlock:we,inputBlock:Be,dropdownBlock:ge,dropdown:ye,buttonBlock:ve,modal:Ce},Ie="_root_1kpbb_2",xe="_selectItem_1kpbb_7",Te="_circle_1kpbb_16",je="_right_1kpbb_45",H={root:Ie,selectItem:xe,circle:Te,right:je};function E(e){const[s,a]=I.useState(!1),r=I.useRef(null),{children:c,preview:g,className:d,positionParams:_,onDelete:m,onEdit:y,onUpdate:v,parentRef:k}=e,[b,h]=I.useState({element:null,offsetX:0}),x=ue.debounce(l=>{v&&(r.current.style.marginLeft="0px",v({sizeX:l}))},100),S=I.useCallback(()=>{let l=0;if(k){const w=Array.from(k.children);if(w.length>1)return l=w.slice(0,-1).reduce((P,i)=>P+i.offsetWidth,0),((k==null?void 0:k.offsetWidth)||0)-l}return l},[k])(),C=l=>{if(r.current){const w=r.current.getBoundingClientRect(),P=l.clientX,i=r.current.offsetWidth,o=_.minWidth??80,f=P-w.left<=20,F=w.right-P<=20;if(f||F){const M=Q=>{const W=Q.clientX-P;let $;f&&W>0?($=Math.max(i-W,o),$>o&&(r.current.style.marginLeft=`${W}px`,x($))):F&&($=W<S?i+W:i+S),$&&$>o&&(r.current.style.width=`${$}px`,x($))},G=()=>{document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",G)};document.addEventListener("mousemove",M),document.addEventListener("mouseup",G)}}},u=()=>{a(!0)},D=l=>{h(l)},O=l=>{var w;l.preventDefault(),D({element:l.currentTarget,offsetX:"clientX"in l?((w=r.current)==null?void 0:w.clientWidth)??0/2:0})},X=l=>{l.key==="Enter"?u():(l.key==="ContextMenu"||l.shiftKey&&l.key==="F10")&&O(l)},N=()=>{a(!1)},K=()=>{h({element:null,offsetX:0})},j={...(_==null?void 0:_.sizeX)&&{width:_.sizeX}};return g?t.jsx("div",{style:j,className:d,children:c}):t.jsxs("div",{className:H.root,style:j,children:[t.jsxs("div",{ref:r,onClick:u,tabIndex:0,onMouseDown:C,onBlur:N,onKeyDown:X,onContextMenu:O,role:"button",className:B(d,{[H.selectItem]:s}),children:[c,t.jsx("div",{className:H.right})]}),b.element&&t.jsxs(ne,{anchorEl:b.element,open:!!b.element,onClose:K,anchorPosition:{top:0,left:0},style:{marginLeft:b.offsetX/2,marginTop:-20},children:[y&&t.jsx(z,{onClick:()=>{y(),K()},children:"Редактировать"}),t.jsx(z,{onClick:()=>{m(),K()},children:"Удалить"})]})]})}const Ne="_defaultInput_ipw2e_2",Se="_selectItem_ipw2e_19",Oe="_createItem_ipw2e_20",Ee="_circle_ipw2e_29",ze="_right_ipw2e_63",Re="_lineContent_ipw2e_96",$e="_preview_ipw2e_104",De="_text_ipw2e_107",Pe="_bold_ipw2e_110",Le="_inputBlock_ipw2e_113",Xe="_marker_ipw2e_123",Fe="_radioButtonsBlock_ipw2e_129",Me="_radioBlock_ipw2e_129",Ke="_radioButton_ipw2e_129",We="_checked_ipw2e_138",Ae="_dropdown_ipw2e_155",Ve="_empty_ipw2e_163",He="_checkbox_ipw2e_167",Ue="_modalDropdown_ipw2e_174",Ge="_headBlock_ipw2e_174",Ye="_deleteButton_ipw2e_184",Je="_createVariable_ipw2e_195",qe="_createVariablePlus_ipw2e_203",Qe="_buttonBlock_ipw2e_214",Ze="_modal_ipw2e_174",n={defaultInput:Ne,selectItem:Se,createItem:Oe,circle:Ee,right:ze,lineContent:Re,preview:$e,text:De,bold:Pe,inputBlock:Le,marker:Xe,radioButtonsBlock:Fe,radioBlock:Me,radioButton:Ke,checked:We,dropdown:Ae,empty:Ve,checkbox:He,modalDropdown:Ue,headBlock:Ge,deleteButton:Ye,createVariable:Je,createVariablePlus:qe,buttonBlock:Qe,modal:Ze},Wt=oe.memo(e=>{const{onCurrentBlockInfo:s,onToggleVisibility:a,updateTemplatesLineItem:r,updateCurrentBlock:c}=et(),g=I.useRef(null),[d,_]=I.useState(""),[m,y]=I.useState(!1),[v,k]=I.useState(!1),[b,h]=I.useState([{id:0,value:-1,label:""}]),{subTemplateId:x,bodyBlockId:L,lineId:S,status:C,type:u="create",isEditValue:D=!1,value:O,handleChange:X,...N}=e,K=()=>{a(!0),s(x,L,S)},j=i=>{if(!D)return;const o={value:i.toString(),...C==="DROPDOWN"&&{value:JSON.stringify(b)},...C==="CHECK_BOX"&&{value:JSON.stringify({value:i.toString(),isChecked:m})}};_(i),c(x,L,S,o),X&&X({id:e.id??S,value:o.value})},l=()=>{r(x,L,S)},w=i=>{c(x,L,S,i)};I.useEffect(()=>{var i;if(O&&_(e.answer??O),O&&C==="DROPDOWN"){const o=JSON.parse(O??"");h(o);const f=e.answer&&JSON.parse(e.answer);_((f==null?void 0:f.value)??((i=o[0])==null?void 0:i.value))}if(O&&C==="CHECK_BOX"){const o=u!=="preview"?d:typeof d=="string"&&JSON.parse(e.answer||O||"{}");y(o.isChecked)}},[]),I.useEffect(()=>{if(C==="CHECK_BOX"){const i=JSON.parse(O||'{"value": ""}'),o={value:JSON.stringify({value:i.value,isChecked:m})};c(x,L,S,o),X&&X({id:e.id??S,value:o.value})}},[m]);const P=()=>{var i;switch(!0){case C==="TEXT":return t.jsx(E,{parentRef:e.parentRef,positionParams:N,preview:u==="preview",onUpdate:w,onDelete:l,className:B(n.lineContent,{[n.preview]:u==="preview"}),children:t.jsx("div",{className:n.inputBlock,children:t.jsx("input",{readOnly:u==="preview",className:B(n.defaultInput,n.text),value:d,onChange:o=>j(o.target.value)})})});case C==="BOLD_TEXT":return t.jsx(E,{parentRef:e.parentRef,positionParams:N,preview:u==="preview",onUpdate:w,onDelete:l,className:B(n.lineContent,{[n.preview]:u==="preview"}),children:t.jsx("div",{className:n.inputBlock,children:t.jsx("input",{readOnly:u==="preview",className:B(n.defaultInput,n.bold),value:d,onChange:o=>j(o.target.value)})})});case C==="POINT_TEXT":return t.jsx(E,{parentRef:e.parentRef,positionParams:N,preview:u==="preview",onUpdate:w,onDelete:l,className:B(n.lineContent,n.marker,{[n.preview]:u==="preview"}),children:t.jsx("div",{className:n.inputBlock,children:t.jsx("input",{readOnly:u==="preview",className:B(n.defaultInput),value:d,onChange:o=>j(o.target.value)})})});case C==="DROPDOWN":return t.jsx(E,{parentRef:e.parentRef,positionParams:{...N,minWidth:90},onUpdate:w,preview:u==="preview",onEdit:()=>k(!0),onDelete:l,className:B(n.lineContent,{[n.preview]:u==="preview"}),children:t.jsx(ae,{value:d||-1,onChange:o=>j(o.target.value),className:n.dropdown,selectNavigate:!0,selectOptions:b,children:b.map(({label:o,value:f})=>t.jsx(z,{value:f,className:"select-link",children:o},f))})});case C==="CHECK_BOX":{let o="";if(u!=="preview"&&!D)o=d;else if(typeof d=="string")try{o=((i=JSON.parse(d))==null?void 0:i.value)??""}catch{o=d}return t.jsx(E,{parentRef:e.parentRef,positionParams:N,onUpdate:w,preview:u==="preview",onDelete:l,className:B(n.lineContent,{[n.preview]:u==="preview"}),children:t.jsx(le,{className:n.checkbox,checked:m,onChange:()=>D&&y(f=>!f),children:t.jsx("input",{readOnly:u==="preview",placeholder:"Ваше значение",className:B(n.defaultInput,n.text),value:o,onChange:f=>j(f.target.value)})})})}case C==="RADIO_BOX":return t.jsx(E,{parentRef:e.parentRef,positionParams:{...N,minWidth:170},onUpdate:w,preview:u==="preview",onDelete:l,className:B(n.lineContent,n.radioButtonsBlock,{[n.preview]:u==="preview"}),children:t.jsxs(t.Fragment,{children:[t.jsxs("button",{type:"button",onClick:()=>j("Yes"),className:B(n.lineContent,n.radioBlock),children:[t.jsx("span",{className:B(n.radioButton,{[n.checked]:d==="Yes"})}),"Да"]}),t.jsxs("button",{type:"button",onClick:()=>j("No"),className:B(n.lineContent,n.radioBlock),children:[t.jsx("span",{className:B(n.radioButton,{[n.checked]:d!=="Yes"})}),"Нет"]})]})});case C==="DATE":return t.jsx(E,{parentRef:e.parentRef,positionParams:{...N,minWidth:170},onUpdate:w,preview:u==="preview",onDelete:l,className:B(n.lineContent,{[n.preview]:u==="preview"}),children:t.jsx(de,{sx:{".MuiInputBase-root.MuiOutlinedInput-root":{width:"150px",height:"42px",padding:"0 20px",maxWidth:"none",background:"#CBECFF",borderRadius:"10px",border:"1px solid #0E5F8C",fontSize:"14px",color:"#0E5F8C"},".MuiInputBase-root .MuiButtonBase-root.MuiIconButton-root":{color:"#0E5F8C"}},value:J(d),onChange:o=>o&&j(J(o).toISOString()),readOnly:!D})});case C==="EMPTY":return t.jsx(E,{parentRef:e.parentRef,positionParams:N,onUpdate:w,preview:u==="preview",onDelete:l,className:B(n.lineContent,n.empty),children:t.jsx("p",{children:u==="create"?"Пустое место":""})});case C==="WRITE_TEXT":return t.jsx(E,{parentRef:e.parentRef,positionParams:{...N,minWidth:200},onUpdate:w,preview:u==="preview",onDelete:l,className:B(n.lineContent),children:t.jsx(re,{value:d.toString(),name:"",onChange:o=>typeof o=="object"?j(o.target.value):"",readOnly:!D})});default:return t.jsxs("div",{ref:g,onClick:K,tabIndex:0,onKeyDown:()=>!1,role:"button",className:B(n.lineContent,n.createItem),children:[t.jsx("div",{className:n.circle,children:" + "}),t.jsx("div",{className:n.right})]})}};return t.jsxs(t.Fragment,{children:[P(),t.jsx(ie,{isOpen:v,type:"custom",onSuccess:()=>k(!1),onClose:()=>k(!1),className:n.modal,children:t.jsxs("div",{className:n.modalDropdown,children:[t.jsx("div",{className:n.headBlock,children:"Дропдаун"}),b.map(({id:i})=>{var o;return t.jsxs("div",{className:n.inputBlock,children:[t.jsx("input",{value:(o=b.find(({id:f})=>i===f))==null?void 0:o.label,onChange:f=>h(F=>F.map(M=>i===M.id?{...M,label:f.target.value}:M)),type:"text",placeholder:b.length===1?"Первый вариант по умолчанию":"Введите вариант"}),t.jsx("button",{type:"button",className:n.deleteButton,disabled:b.length===1,onClick:()=>h(f=>f.filter(({id:F})=>i!==F)),children:"x"})]},i)}),t.jsxs(V,{className:n.createVariable,onClick:()=>h(i=>[...i,{id:i.length+1,value:i.length+1,label:""}]),type:"button",color:"primary-reverse",children:[t.jsx("div",{className:n.createVariablePlus,children:"+"}),"Создать вариант"]}),t.jsxs("div",{className:n.buttonBlock,children:[t.jsx(V,{className:n.submit,type:"submit",color:"secondary",onClick:()=>{l(),k(!1)},children:"Назад"}),t.jsx(V,{className:n.submit,type:"submit",color:"primary",onClick:()=>{w({value:JSON.stringify(b)}),k(!1)},children:"Сохранить"})]})]})})]})}),U=(e,s,a)=>{e(r=>({templates:r.templates.map(c=>c.subTemplateId===s?a(c):c)}))},et=se((e,s)=>({toggleVisibility:!1,selectTemplateItem:"",currentBlockInfo:null,templates:[{name:"",positionId:0,subTemplateId:0,lineBlocks:[{positionId:0,bodyBlockId:0,blockInfo:[]}]}],handleTemplatesTitle:(a,r)=>{e(c=>({templates:c.templates.map(g=>g.subTemplateId===a?{...g,name:r}:g)}))},addTemplatesLine:a=>{U(e,a,r=>{const c=r.lineBlocks.length,g={positionId:c,bodyBlockId:c,blockInfo:[]};return{...r,lineBlocks:[...r.lineBlocks,g]}})},updateTemplatesLine:(a,r)=>{U(e,a,c=>({...c,lineBlocks:r}))},onToggleVisibility:a=>{e({toggleVisibility:a,currentBlockInfo:null})},handleTemplates:a=>{e({templates:a})},onCurrentBlockInfo:(a,r,c)=>{e({currentBlockInfo:{subTemplateId:a,bodyBlockId:r,lineId:c}})},updateTemplatesLineItem:(a,r,c)=>{const{templates:g}=s(),d=g.map(_=>{if(_.subTemplateId!==a)return _;const m=_.lineBlocks.map(y=>{if(y.bodyBlockId!==r)return y;const v=y.blockInfo.filter(({lineId:k})=>k!==c);return{...y,blockInfo:v}});return{..._,lineBlocks:m}});e({templates:d})},addCurrentBlock:a=>{const{currentBlockInfo:r}=s();if(!r)return;const{subTemplateId:c,bodyBlockId:g,lineId:d}=r;U(e,c,_=>({..._,lineBlocks:_.lineBlocks.map(m=>{if(m.bodyBlockId===g){if(m.blockInfo.length===0)return{...m,blockInfo:[{lineId:0,positionId:0,sizeX:0,sizeY:0,space:0,status:a,value:""},{lineId:1,positionId:1,sizeX:0,sizeY:0,space:0,status:"default",value:""}]};const y=m.blockInfo.length+2;return{...m,blockInfo:[...m.blockInfo.map(v=>{if(v.lineId===d){const k=m.blockInfo.length+1;return{lineId:k,positionId:k,sizeX:0,sizeY:0,space:0,status:a,value:""}}return v}),{lineId:y,positionId:y,sizeX:0,sizeY:0,space:0,status:"default",value:""}]}}return m})})),e({toggleVisibility:!1,currentBlockInfo:null})},updateCurrentBlock:(a,r,c,g)=>{const{templates:d}=s(),_=d.map(m=>{if(m.subTemplateId!==a)return m;const y=m.lineBlocks.map(v=>{if(v.bodyBlockId!==r)return v;const k=v.blockInfo.map(b=>b.lineId===c?{...b,...g}:b);return{...v,blockInfo:k}});return{...m,lineBlocks:y}});e({templates:_})}})),tt="_wrapper_k08z0_2",nt="_draggable_k08z0_8",ot="_headBlock_k08z0_19",at="_blockWithPadding_k08z0_20",st="_defaultInput_k08z0_30",rt="_dragHandleLeft_k08z0_47",lt="_contentBlockDraggable_k08z0_48",ct="_dragHandleRight_k08z0_59",it="_show_k08z0_73",dt="_createLineBlock_k08z0_77",ut="_createLine_k08z0_77",pt="_text_k08z0_92",mt="_contentBlock_k08z0_48",_t="_lineContent_k08z0_105",kt="_bold_k08z0_116",ht="_list_k08z0_119",ft="_inputBlock_k08z0_119",bt="_radioBlock_k08z0_125",wt="_radioButton_k08z0_125",Bt="_checked_k08z0_134",gt="_dropdown_k08z0_151",yt="_empty_k08z0_159",vt="_selectItem_k08z0_163",Ct="_createItem_k08z0_164",It="_circle_k08z0_173",xt="_right_k08z0_207",At={wrapper:tt,draggable:nt,headBlock:ot,blockWithPadding:at,defaultInput:st,dragHandleLeft:rt,contentBlockDraggable:lt,dragHandleRight:ct,show:it,createLineBlock:dt,createLine:ut,text:pt,contentBlock:mt,lineContent:_t,bold:kt,list:ht,inputBlock:ft,radioBlock:bt,radioButton:wt,checked:Bt,dropdown:gt,empty:yt,selectItem:vt,createItem:Ct,circle:It,right:xt},p={root:["appointment-table"],templateGetAll:e=>[...p.root,`template-get-all-${e}`],deleteTemplate:()=>[...p.root,"template-delete-template"],deleteSubTemplate:()=>[...p.root,"template-delete-sub-template"],deleteBodyBlock:()=>[...p.root,"template-delete-body-block"],templateGetOne:e=>[...p.root,`template-get-one-${e}`],createUpdateBodyBlock:()=>[...p.root,"create-update-body-block"],createTemplate:()=>[...p.root,"create-template"],createSubTemplate:()=>[...p.root,"create-sub-template"],treatment:(e,s)=>[...p.root,`treatment-treatment-get-${e}-${s}`],treatmentId:()=>[...p.root,"treatment-treatment-get-by-id"],treatmentCreate:()=>[...p.root,"treatment-treatment-create"],treatmentUpdate:()=>[...p.root,"treatment-treatment-update"],treatmentAnswerCreate:()=>[...p.root,"treatment-answer-create"]};function Vt(){return R({mutationKey:p.createUpdateBodyBlock(),mutationFn:async e=>(await T({url:"/template/create-update-body-block",method:"POST",data:e})).data})}function Ht(){return R({mutationKey:p.createTemplate(),mutationFn:async e=>(await T({url:"/template/create-template",method:"POST",data:e})).data})}function Ut(){return R({mutationKey:p.createSubTemplate(),mutationFn:async e=>(await T({url:"/template/create-sub-template",method:"POST",data:e})).data})}function Gt(e){return A({queryKey:p.templateGetOne(e),queryFn:async()=>(await T({url:`/template/get-one/${e}`,method:"GET"})).data})}function Tt({offset:e,limit:s,category:a}){return A({queryKey:p.templateGetAll(a),queryFn:async()=>(await T({url:"/template/get-all",method:"GET",params:{offset:e,limit:s,category:a}})).data})}function jt(){return R({mutationKey:p.deleteTemplate(),mutationFn:async e=>(await T({url:`/template/delete-template/${e}`,method:"DELETE"})).data})}function Yt(){return R({mutationKey:p.deleteSubTemplate(),mutationFn:async e=>(await T({url:`/template/delete-sub-template/${e}`,method:"DELETE"})).data})}function Jt(){return R({mutationKey:p.deleteBodyBlock(),mutationFn:async e=>(await T({url:`/template/delete-body-block/${e}`,method:"POST"})).data})}function qt(e){return A({queryKey:p.treatment(e.patientId,e.category??""),queryFn:async()=>(await T({url:"/treatment/treatment-get",method:"GET",params:e})).data})}function Qt(e){return A({queryKey:p.treatmentId(),queryFn:async()=>{const s=await T({url:`/treatment/treatment-get-by-id/${e}`,method:"GET"});return s==null?void 0:s.data[0]}})}function Zt(){return R({mutationKey:p.treatmentCreate(),mutationFn:async e=>(await T({url:"/treatment/treatment-create",method:"POST",data:e})).data})}function en(){return R({mutationKey:p.treatmentCreate(),mutationFn:async e=>(await T({url:"/treatment/treatment-update",method:"POST",data:e})).data})}function tn(){return R({mutationKey:p.treatmentCreate(),mutationFn:async e=>(await T({url:"/treatment/answer-create",method:"POST",data:e})).data})}export{Wt as C,_e as R,Mt as T,Ut as a,Yt as b,jt as c,Vt as d,Jt as e,et as f,Qt as g,tn as h,en as i,Ht as j,Zt as k,q as l,At as m,Tt as n,qt as o,Kt as s,Gt as u};
