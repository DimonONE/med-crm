import{h as i,r,u as g,j as e,B as w,aM as j,Q as y,aN as L,aO as v,P as E}from"./index-b826c59e.js";import{a as b,b as S,F as c,E as m}from"./formik.esm-694da4e8.js";import{c as V,a as d}from"./index.esm-047a7054.js";import{s as l}from"./sessionApi-13ff7923.js";import{u as h}from"./useQuery-1e0feab9.js";import{u as M}from"./useMutation-411caa39.js";import{T as u}from"./TextField-cadfc444.js";import{C as F,T as N}from"./Container-cb157327.js";import"./useBaseQuery-cb9da475.js";import"./styles.module-6cec8057.js";const T=s=>h({queryKey:l.session.currentUser(),queryFn:async()=>(await i({url:"/users/currentuser"})).data,enabled:s==null?void 0:s.enabled}),H=s=>h({queryKey:l.session.roles(),queryFn:async()=>(await i({url:"/users/roles"})).data,enabled:s==null?void 0:s.enabled}),Z=()=>M({mutationKey:l.mutation.login(),mutationFn:s=>i({url:"/users/login",method:"POST",data:s})}),q=s=>r.createElement("svg",{width:23,height:16,viewBox:"0 0 23 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},r.createElement("path",{d:"M14.7591 8.77637L12.9281 10.6135C12.1856 11.3586 10.8792 11.3747 10.1207 10.6135L8.28961 8.77637L1.71332 15.374C1.95811 15.4872 2.22801 15.5547 2.51494 15.5547H20.5338C20.8208 15.5547 21.0906 15.4873 21.3353 15.374L14.7591 8.77637Z",fill:"#578695"}),r.createElement("path",{d:"M20.5338 0.183594H2.51492C2.22798 0.183594 1.95809 0.251143 1.71338 0.364338L8.74061 7.41488C8.74108 7.41535 8.74163 7.41544 8.7421 7.41591C8.74257 7.41638 8.74266 7.41702 8.74266 7.41702L11.0276 9.70951C11.2703 9.95221 11.7785 9.95221 12.0212 9.70951L14.3057 7.4174C14.3057 7.4174 14.3062 7.41638 14.3067 7.41591C14.3067 7.41591 14.3077 7.41535 14.3082 7.41488L21.3352 0.364295C21.0905 0.251058 20.8207 0.183594 20.5338 0.183594Z",fill:"#578695"}),r.createElement("path",{d:"M0.797862 1.25977C0.671218 1.51587 0.593506 1.80016 0.593506 2.10469V13.6334C0.593506 13.9379 0.671132 14.2222 0.797819 14.4783L7.38551 7.86923L0.797862 1.25977Z",fill:"#578695"}),r.createElement("path",{d:"M22.2509 1.25977L15.6633 7.86932L22.2509 14.4784C22.3776 14.2223 22.4553 13.938 22.4553 13.6334V2.10477C22.4553 1.80016 22.3776 1.51587 22.2509 1.25977Z",fill:"#578695"})),U=s=>r.createElement("svg",{width:19,height:22,viewBox:"0 0 19 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},r.createElement("path",{d:"M15.9131 8.46984H15.1836V5.82788C15.1836 2.91379 12.5662 0.543945 9.34758 0.543945C6.129 0.543945 3.51153 2.91379 3.51153 5.82788V8.46984H2.78202C1.57591 8.46984 0.593506 9.35843 0.593506 10.4513V19.6982C0.593506 20.7911 1.57591 21.6797 2.78202 21.6797H15.9131C17.1193 21.6797 18.1017 20.7911 18.1017 19.6982V10.4513C18.1017 9.35843 17.1193 8.46984 15.9131 8.46984ZM5.45688 5.82788C5.45688 3.88515 7.20186 2.30526 9.34758 2.30526C11.4933 2.30526 13.2383 3.88515 13.2383 5.82788V8.46984H5.45688V5.82788ZM10.3203 15.2703V17.2764C10.3203 17.7625 9.88547 18.1571 9.34758 18.1571C8.80969 18.1571 8.37491 17.7625 8.37491 17.2764V15.2703C7.79616 14.9647 7.40223 14.4028 7.40223 13.7538C7.40223 12.7824 8.27472 11.9925 9.34758 11.9925C10.4204 11.9925 11.2929 12.7824 11.2929 13.7538C11.2929 14.4028 10.899 14.9647 10.3203 15.2703Z",fill:"#578695"}));function $(){const{mutate:s}=Z(),{refetch:n}=T({enabled:!1}),{refetch:p}=H({enabled:!1}),C=g(),f=async()=>{const{data:t}=await n();if(t){const a=await p();if(L(t),a!=null&&a.data){const o=a.data;v(o),C(E.root)}}},x=async(t,{setSubmitting:a})=>{s(t,{onSuccess:async o=>{await j(o.data),f()},onSettled:()=>{a(!1)},onError:()=>{y("User not found!",{type:"error"})}})};return e.jsx("div",{className:"auth-page",children:e.jsx(F,{children:e.jsxs(e.Fragment,{children:[e.jsx(N,{}),e.jsx(b,{initialValues:{email:"",password:""},validationSchema:V().shape({email:d().email().required(),password:d().min(5).required()}),onSubmit:x,children:({isSubmitting:t})=>e.jsxs(S,{className:"full-width center",children:[e.jsx(c,{name:"email",children:a=>e.jsx(u,{...a,iconStart:e.jsx(q,{}),placeholder:"Почта",className:"form-input",type:"text"})}),e.jsx(c,{name:"password",children:a=>e.jsx(u,{...a,placeholder:"Пароль",iconStart:e.jsx(U,{}),className:"form-input",type:"password"})}),e.jsx(w,{className:"form-submit",type:"submit",color:"primary",disabled:t,children:"Вход"}),e.jsxs("div",{className:"error-message",children:[e.jsx(m,{name:"email"}),e.jsx("br",{}),e.jsx(m,{name:"password"})]})]})})]})})})}export{$ as default};
