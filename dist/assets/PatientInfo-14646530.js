import{R as P,b as Y,r as l,j as e,c as r,e as D,d as I,S as H,M as T,B as p,Q as V,u as R,i as F,k as M,P as w}from"./index-8d56a7e0.js";import{T as Z,a as O,I as $,b as q,c as A,d as N,S as E,e as U}from"./arrow-bottom-filter-6547bfd6.js";import{a as W}from"./doctorApi-43b25d72.js";import{a as G,b as Q}from"./patientsApi-1d2a3c98.js";import{s as i}from"./styles.module-60167116.js";import"./index.esm-1a25c3bb.js";import{L as z}from"./LoadImage-1ed91e32.js";/* empty css               */import{F as J}from"./FileLoader-ce2df32d.js";import"./styles.module-eea2a584.js";import"./styles.module-4835680a.js";import{e as K}from"./utils-045dd2ef.js";import{S as k}from"./close-gray-ico-2aa4651a.js";import{u as X}from"./servicesApi-ebda93ac.js";import"./styles.module-84e050ca.js";import"./styles.module-6cec8057.js";const e1="_tableCellItem_o5dqw_1",s1="_statusInfo_o5dqw_8",t1="_status_o5dqw_8",a1="_cancel_o5dqw_17",n1="_date_o5dqw_20",c1="_name_o5dqw_23",b={tableCellItem:e1,statusInfo:s1,status:t1,cancel:a1,date:n1,name:c1},J1=P.forwardRef((o,g)=>{const[,f]=Y(),[S,j]=l.useState("ASC"),{patientList:u,dataLength:t,hasNextPage:v,handleUpdateFilters:x,handleFetchNextPage:d,onScroll:y}=o,L=n=>{n==="sortBy"&&j(C=>C==="ASC"?"DESC":"ASC")};return l.useEffect(()=>{const n={sortBy:S},C=new URLSearchParams;Object.entries(n).forEach(([_,a])=>{a!=null&&C.set(_,a)}),f(C),x(n)},[S]),u.length?e.jsx("div",{className:r(b.root,"container"),children:e.jsx(Z,{id:"all-patient-table",ref:g,className:"table-container",onScroll:y,component:D,children:e.jsx(O,{sx:{minWidth:850},"aria-label":"simple table",children:e.jsxs($,{scrollableTarget:"all-patient-table",next:d,hasMore:v||!1,loader:null,dataLength:t,children:[e.jsx(q,{children:e.jsxs(A,{children:[e.jsx(N,{width:"auto",sx:{minWidth:180},className:"table-head-cell",onClick:()=>L("sortBy"),children:e.jsxs("span",{className:b.tableCellItem,children:["ДАТА РОЖ.",e.jsx(E,{})]})}),e.jsx(N,{width:"auto",sx:{minWidth:360},className:"table-head-cell",children:"СТАТУС И ДАТА ЗАПИСИ"}),e.jsx(N,{width:"auto",sx:{minWidth:180},className:"table-head-cell",children:"ТЕЛЕФОН"}),e.jsx(N,{width:"100%",className:"table-head-cell",onClick:()=>L("reminder"),children:e.jsxs("span",{className:b.tableCellItem,children:["НАПОМИНАНИЕ",e.jsx(E,{})]})})]})}),e.jsx(U,{children:u.map(n=>e.jsxs(A,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(N,{className:"table-body-cell",component:"th",scope:"row",children:I(n.createdAt).format("DD.MM.YYYY")}),e.jsx(N,{className:"table-body-cell",component:"th",scope:"row",children:e.jsxs("div",{className:b.statusInfo,children:[e.jsx("div",{className:r(b.status,{[b.cancel]:n.status!=="active"}),children:n.status==="active"?"Запись завершена":"Запись отменена"}),e.jsx("div",{className:b.date,children:I(n.createdAt).format("DD.MM.YYYY dd HH:mm")}),e.jsx("div",{className:b.name,children:n.fullName})]})}),e.jsx(N,{className:"table-body-cell",children:n.phone}),e.jsx(N,{className:"table-body-cell"})]},n.createdAt))})]})})})}):null});function l1(o){const{isOpen:g,record:f,onSuccess:S,onClose:j}=o,[u,t]=l.useState([]),[v,x]=l.useState([]),{data:d}=X(),{mutate:y}=G(),L=u.reduce((a,c)=>a+c.price,0),n=a=>{const c=d==null?void 0:d.find(({id:h})=>a===h),m=v.filter(({value:h})=>a!==h);c&&(t(h=>[...h,c]),x(m))},C=a=>{const c=u.filter(({id:h})=>a!==h),m=d==null?void 0:d.find(({id:h})=>a===h);t(c),m&&x(h=>[...h,{value:m.id,label:m.name}])},_=()=>{const a=u.map(({name:m,price:h})=>({price:h,name:m})),c={id:f.id,userId:f.userId,startTime:f.startTime,endTime:f.endTime,notice:f.notice??"",servicePrices:a};y(c,{onSuccess:()=>{S({services:u}),j()},onError:m=>{V(K(m),{type:"error"})}})};return l.useEffect(()=>{const a=d?[{value:-1,label:"Выберите услугу"},...d.map(({id:c,name:m})=>({value:c,label:m}))]:[];x(a),t([])},[d,g]),!g||!v.length?null:e.jsx("div",{className:i.root,children:e.jsxs("div",{className:i.modal,children:[e.jsx("button",{type:"button",className:i.modalCloseButton,onClick:j,children:e.jsx(k,{})}),e.jsxs("div",{children:[e.jsx("span",{className:i.title,children:"Добавить услуги"}),e.jsx(H,{value:-1,onChange:a=>n(a.target.value),className:r("form-input",i.dropdown),selectOptions:v,children:v.map(({label:a,value:c})=>e.jsx(T,{value:c,children:a},c))}),e.jsx("div",{className:i.servicesList,children:u.map(({id:a,price:c,name:m})=>e.jsxs("div",{className:i.servicesItem,children:[e.jsxs("span",{className:i.price,children:["₽ ",c]}),e.jsx("span",{className:i.info,children:m}),e.jsx(p,{color:"primary-reverse",onClick:()=>C(a),children:e.jsx(k,{})})]},a))})]}),e.jsxs("div",{className:i.priceAll,children:["₽ ",L," ",e.jsx("span",{className:i.priceText,children:"Вся сумма"})," "]}),e.jsxs("div",{className:i.buttonsSubmit,children:[e.jsx(p,{color:"secondary",className:i.button,onClick:j,children:"Отмена"}),e.jsx(p,{className:i.button,onClick:_,children:"Применить"})]})]})})}const o1="_root_8yh7o_1",i1="_navigateInfo_8yh7o_11",r1="_name_8yh7o_16",d1="_blockInfo_8yh7o_24",m1="_textBold_8yh7o_35",h1="_textSuccess_8yh7o_39",x1="_textValue_8yh7o_43",u1="_image_8yh7o_48",C1="_userImage_8yh7o_53",f1="_buttonSuccess_8yh7o_56",j1="_buttonCancel_8yh7o_57",p1="_userInfo_8yh7o_68",v1="_textInfo_8yh7o_91",_1="_icon_8yh7o_96",N1="_date_8yh7o_100",b1="_passportNumber_8yh7o_103",I1="_recording_8yh7o_107",g1="_contentInfo_8yh7o_107",S1="_note_8yh7o_107",L1="_nameDisease_8yh7o_115",y1="_noteInfo_8yh7o_119",w1="_priceAll_8yh7o_123",M1="_button_8yh7o_56",B1="_buttonAttendance_8yh7o_141",A1="_tableInfo_8yh7o_162",s={root:o1,navigateInfo:i1,name:r1,blockInfo:d1,textBold:m1,textSuccess:h1,textValue:x1,image:u1,userImage:C1,buttonSuccess:f1,buttonCancel:j1,userInfo:p1,textInfo:v1,icon:_1,date:N1,passportNumber:b1,recording:I1,contentInfo:g1,note:S1,nameDisease:L1,noteInfo:y1,priceAll:w1,button:M1,buttonAttendance:B1,tableInfo:A1},E1=o=>l.createElement("svg",{width:26,height:19,viewBox:"0 0 26 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},l.createElement("path",{d:"M0.979308 9.6363L8.39534 17.8763C8.55355 18.051 8.77438 18.1499 9.00839 18.1499L13.9524 18.1499C14.2771 18.1499 14.5721 17.9587 14.7056 17.6621C14.8374 17.3638 14.783 17.0161 14.5655 16.7755L7.64549 9.08587L14.5655 1.39792C14.783 1.15566 14.839 0.807932 14.7056 0.511291C14.5721 0.213001 14.2771 0.0218334 13.9524 0.0218333L9.0084 0.0218329C8.77438 0.0218329 8.55355 0.12236 8.39534 0.293754L0.979308 8.53378C0.697499 8.84691 0.697499 9.32483 0.979308 9.6363Z",fill:"#876AFF"}),l.createElement("path",{d:"M11.6912 9.6363L19.1073 17.8763C19.2655 18.051 19.4863 18.1499 19.7203 18.1499L24.6643 18.1499C24.989 18.1499 25.284 17.9587 25.4175 17.6621C25.5493 17.3638 25.4949 17.0161 25.2774 16.7755L18.3574 9.08587L25.2774 1.39792C25.4949 1.15566 25.551 0.807932 25.4175 0.511291C25.284 0.213001 24.989 0.0218334 24.6643 0.0218333L19.7203 0.0218329C19.4863 0.0218329 19.2655 0.12236 19.1073 0.293754L11.6912 8.53378C11.4094 8.84691 11.4094 9.32483 11.6912 9.6363Z",fill:"#876AFF"})),B=o=>l.createElement("svg",{width:23,height:22,viewBox:"0 0 23 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},l.createElement("path",{d:"M17.2511 14.0119C16.6666 14.0119 16.1942 14.4844 16.1942 15.0688V18.3888C16.1942 18.9722 15.7207 19.4457 15.1373 19.4457H3.51069C2.92724 19.4457 2.45376 18.9722 2.45376 18.3888V4.64834C2.45376 4.06489 2.92728 3.59141 3.51069 3.59141H9.6516C10.2361 3.59141 10.7085 3.11895 10.7085 2.53447C10.7085 1.95 10.2361 1.47754 9.6516 1.47754H3.51069C1.76249 1.47745 0.339844 2.90014 0.339844 4.64834V18.3888C0.339844 20.137 1.76249 21.5596 3.51069 21.5596H15.1372C16.8854 21.5596 18.308 20.138 18.308 18.3888V15.0689C18.3081 14.4844 17.8356 14.0119 17.2511 14.0119Z",fill:"#229CE1"}),l.createElement("path",{d:"M20.9155 1.34331C20.1481 0.57598 19.1461 0.189105 18.1367 0.167985C17.0745 0.144741 16.0059 0.529448 15.2026 1.33379L8.04701 8.4894C7.00273 9.53792 6.42773 10.9289 6.42773 12.4065V14.774C6.42773 15.3585 6.90019 15.831 7.48467 15.831H9.85223C11.3299 15.831 12.7208 15.256 13.7704 14.2106L20.9164 7.06454C22.4913 5.4887 22.4913 2.9203 20.9155 1.34331ZM12.277 12.7151C11.629 13.3609 10.7666 13.7171 9.85232 13.7171H8.54165V12.4065C8.54165 11.4922 8.89784 10.6297 9.54257 9.98288L14.2598 5.26568L16.993 7.99896L12.277 12.7151ZM19.4209 5.57114L18.4876 6.50445L15.7543 3.77118L16.6876 2.8379C17.4423 2.08323 18.6683 2.08536 19.4209 2.8379C20.1735 3.59147 20.1735 4.81753 19.4209 5.57114Z",fill:"#229CE1"})),k1=o=>l.createElement("svg",{width:19,height:13,viewBox:"0 0 19 13",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},l.createElement("path",{d:"M16.9766 0.180664H2.14062C1.26654 0.180664 0.558594 0.893 0.558594 1.7627V11.2549C0.558594 12.1297 1.27174 12.8369 2.14062 12.8369H16.9766C17.8433 12.8369 18.5586 12.1327 18.5586 11.2549V1.7627C18.5586 0.894547 17.8535 0.180664 16.9766 0.180664ZM16.755 1.23535C16.4318 1.55686 10.8693 7.09003 10.6773 7.28107C10.3784 7.5799 9.98117 7.74443 9.55859 7.74443C9.13602 7.74443 8.73875 7.57986 8.43894 7.28008C8.30977 7.15159 2.8087 1.67952 2.36218 1.23535H16.755ZM1.61328 11.0402V1.97803L6.17087 6.5116L1.61328 11.0402ZM2.36285 11.7822L6.91864 7.2554L7.69415 8.02684C8.19218 8.52486 8.85431 8.79911 9.55859 8.79911C10.2629 8.79911 10.925 8.52486 11.4221 8.02782L12.1985 7.2554L16.7543 11.7822H2.36285ZM17.5039 11.0402L12.9463 6.5116L17.5039 1.97803V11.0402Z",fill:"#0E5F8C"})),P1=o=>l.createElement("svg",{width:19,height:19,viewBox:"0 0 19 19",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},l.createElement("path",{d:"M15.7112 11.2114C15.3184 10.8024 14.8445 10.5836 14.3422 10.5836C13.844 10.5836 13.3661 10.7983 12.957 11.2074L11.6771 12.4832C11.5718 12.4265 11.4665 12.3739 11.3653 12.3212C11.2194 12.2483 11.0817 12.1795 10.9643 12.1066C9.76539 11.3451 8.67586 10.3528 7.63088 9.06883C7.1246 8.42889 6.78437 7.8902 6.5373 7.3434C6.86943 7.03963 7.17725 6.72371 7.47697 6.41994C7.59038 6.30653 7.70379 6.18907 7.8172 6.07566C8.66776 5.2251 8.66776 4.12342 7.8172 3.27285L6.71146 2.16712C6.58591 2.04156 6.4563 1.91195 6.33479 1.78234C6.09177 1.53123 5.8366 1.27201 5.57333 1.02899C5.18045 0.640159 4.71062 0.433594 4.21648 0.433594C3.72234 0.433594 3.24441 0.640159 2.83938 1.02899C2.83533 1.03304 2.83533 1.03304 2.83128 1.03709L1.45418 2.42634C0.935737 2.94478 0.640065 3.57663 0.57526 4.30973C0.478053 5.49242 0.826379 6.5941 1.0937 7.31505C1.74985 9.08503 2.73002 10.7254 4.19218 12.4832C5.96621 14.6015 8.10072 16.2743 10.539 17.453C11.4706 17.8944 12.714 18.4169 14.1033 18.506C14.1883 18.5101 14.2774 18.5141 14.3584 18.5141C15.2941 18.5141 16.0798 18.178 16.6955 17.5097C16.6995 17.5016 16.7076 17.4975 16.7117 17.4894C16.9223 17.2342 17.1653 17.0034 17.4205 16.7563C17.5946 16.5902 17.7728 16.4161 17.947 16.2338C18.348 15.8166 18.5586 15.3306 18.5586 14.8324C18.5586 14.3302 18.3439 13.8482 17.9348 13.4432L15.7112 11.2114ZM17.1612 15.4764C17.1572 15.4764 17.1572 15.4805 17.1612 15.4764C17.0033 15.6465 16.8413 15.8004 16.6671 15.9705C16.4038 16.2217 16.1365 16.4849 15.8854 16.7806C15.4763 17.218 14.9943 17.4246 14.3625 17.4246C14.3017 17.4246 14.2369 17.4246 14.1762 17.4206C12.9732 17.3436 11.8553 16.8738 11.0169 16.4728C8.72446 15.363 6.71147 13.7874 5.03869 11.7906C3.65754 10.126 2.73407 8.58685 2.12247 6.93433C1.7458 5.9258 1.60809 5.14004 1.66884 4.39884C1.70934 3.92495 1.89161 3.53207 2.22778 3.1959L3.60894 1.81475C3.8074 1.62843 4.01802 1.52717 4.22458 1.52717C4.47975 1.52717 4.68632 1.68109 4.81592 1.8107C4.81997 1.81475 4.82403 1.8188 4.82808 1.82285C5.07514 2.05371 5.31006 2.29268 5.55713 2.54785C5.68269 2.67746 5.8123 2.80707 5.94191 2.94073L7.04764 4.04646C7.47697 4.47579 7.47697 4.87272 7.04764 5.30205C6.93018 5.41951 6.81677 5.53697 6.69931 5.65038C6.35909 5.99871 6.03507 6.32273 5.68269 6.63865C5.67459 6.64675 5.66649 6.6508 5.66244 6.6589C5.31411 7.00723 5.37892 7.34746 5.45182 7.57832C5.45587 7.59047 5.45992 7.60262 5.46397 7.61478C5.75154 8.31143 6.15657 8.96758 6.77222 9.74928L6.77627 9.75333C7.89415 11.1304 9.07279 12.2038 10.3729 13.026C10.539 13.1313 10.7091 13.2163 10.8711 13.2973C11.0169 13.3703 11.1546 13.4391 11.2721 13.512C11.2883 13.5201 11.3045 13.5323 11.3207 13.5404C11.4584 13.6092 11.588 13.6416 11.7217 13.6416C12.0579 13.6416 12.2685 13.431 12.3373 13.3622L13.7225 11.9769C13.8602 11.8392 14.079 11.6732 14.3341 11.6732C14.5852 11.6732 14.7918 11.8311 14.9174 11.9688C14.9214 11.9729 14.9214 11.9729 14.9255 11.9769L17.1572 14.2087C17.5744 14.6218 17.5744 15.0471 17.1612 15.4764Z",fill:"#0E5F8C"}));function K1({patientId:o,backButtonLink:g}){const f=R(),{checkUserRole:S}=F(),[j,u]=l.useState(null),{data:t,isLoading:v}=Q(o),{data:x,refetch:d}=W(o),y=I().diff(I(t==null?void 0:t.dateOfBirth),"year"),L=l.useMemo(()=>x?x.reduce((n,C)=>{const _=C.servicePrices.reduce((a,c)=>a+c.price,0);return n+_},0):0,[x]);return!t&&!v||!t?null:e.jsxs("div",{className:r(s.root,"container"),children:[e.jsxs("div",{className:s.navigateInfo,children:[e.jsx(M,{to:g??w.patients.records,children:e.jsx(E1,{})}),e.jsx("span",{className:s.name,children:t.fullName}),S("medChief")&&e.jsx(p,{color:"primary-reverse",children:e.jsx(B,{})})]}),e.jsxs("div",{className:r("d-flex",s.blockInfo),children:[e.jsxs("div",{className:s.image,children:[e.jsx(z,{className:s.userImage,defaultImage:t.image}),e.jsx(p,{className:r(s.button,s.buttonSuccess,s.buttonRecord),onClick:()=>f(w.patients.editRecord(o)),children:"Записать"}),e.jsx(p,{className:r(s.button,s.buttonCancel),onClick:()=>!1,children:"Напоминание"})]}),e.jsxs("div",{className:s.userInfo,children:[e.jsxs("div",{className:s.textInfo,children:[e.jsx("div",{className:s.icon,children:e.jsx(P1,{})}),t.phone]}),e.jsxs("div",{className:s.textInfo,children:[e.jsx("div",{className:s.icon,children:e.jsx(k1,{})}),t.email]}),e.jsx("div",{className:s.textInfo,children:t.sex}),e.jsxs("div",{className:s.textInfo,children:[I(t.dateOfBirth).format("DD.MM.YYYY")," | ",y," год(а)"]}),e.jsxs("div",{className:s.textInfo,children:["Код клиента: ",t.id]}),e.jsxs("div",{className:r(s.textInfo,s.date),children:["Рег. ",I(t.createdAt).format("DD.MM.YYYY")]})]}),e.jsxs("div",{className:s.userInfo,children:[e.jsx("div",{className:s.textInfo,children:t.country}),e.jsx("div",{className:s.textInfo,children:t.city}),e.jsx("div",{className:s.textInfo,children:t.address}),e.jsxs("div",{className:r(s.textInfo,s.passportNumber),children:["Номер паспорта: ",t.passport]}),e.jsx("div",{className:s.textInfo,children:t.passportIssuingAuthority})]}),t.files?e.jsxs("div",{children:[e.jsx("div",{className:s.textBold,children:"Прикрепленные документы"}),e.jsx("br",{}),e.jsx(J,{id:"patient-info-files",title:"Загрузить",hiddenButton:!0,filesData:t.files})]}):null]}),x==null?void 0:x.map(n=>e.jsxs("div",{className:s.blockInfo,children:[e.jsxs("div",{className:s.recording,children:[e.jsxs("div",{className:r(s.textBold,s.textSuccess,"d-flex"),children:["Запись:",e.jsx("button",{type:"button",onClick:()=>!1,children:e.jsx(B,{})})]}),e.jsxs("div",{className:s.contentInfo,children:[e.jsxs("div",{children:[`${I(n.startTime).format("DD.MM.YYYY")} | ${I(n.startTime).format("HH:mm dddd")}`," "]}),e.jsxs("div",{children:[e.jsx("span",{children:"Стоматолог:"}),e.jsx("span",{className:s.textValue,children:t.user.fullName})]})]})]}),e.jsxs("div",{className:s.recording,children:[e.jsxs("div",{className:r(s.textBold,"d-flex"),children:["Услуги:",e.jsx("button",{type:"button",onClick:()=>{u(n)},children:e.jsx(B,{})})]}),e.jsx("div",{className:s.contentInfo,children:n.servicePrices.map(({price:C,name:_})=>e.jsx("div",{className:s.nameDisease,children:_},`${_}-${C}`))})]}),e.jsxs("div",{className:s.note,children:[e.jsx("div",{className:s.textBold,children:"Жалоба:"}),e.jsx("div",{className:s.contentInfo,children:e.jsx("div",{className:s.noteInfo,children:"Болят зубы, желтый налет, смешение швардевита."})})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx(p,{className:r(s.button,s.buttonSuccess),onClick:()=>!1,children:"В оплату"}),e.jsx(p,{className:r(s.button,s.buttonAttendance),onClick:()=>!1,children:"Неявка"}),e.jsx(p,{className:r(s.button,s.buttonCancel),onClick:()=>!1,children:"Отмена"}),e.jsxs("span",{className:s.priceAll,children:["₽ ",L,"  "]})]})]},n.id)),e.jsxs("div",{className:s.blockInfo,children:[e.jsxs("div",{children:[e.jsx("span",{children:"Всего посещений:"}),e.jsx("span",{className:s.textValue,children:"9"})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Выручка по клиенту:"}),e.jsx("span",{className:s.textValue,children:"$ 22 445"})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Неявки:"}),e.jsx("span",{className:s.textValue,children:"1"})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Отмены:"}),e.jsx("span",{className:s.textValue,children:"2"})]})]}),e.jsx(M,{to:w.receptionTable.root,className:s.tableInfo,children:"Таблица приема"}),e.jsx(M,{to:w.medInfo.cards(o),className:s.tableInfo,children:"Медицинская информация"}),e.jsx("div",{className:s.tableInfo,children:"История платажей"}),e.jsx(M,{to:w.patients.files("shared"),className:s.tableInfo,children:"Файлы"}),j&&e.jsx(l1,{record:j,isOpen:!!j,onClose:()=>u(null),onSuccess:()=>{d()}})]})}export{K1 as P,J1 as a};
