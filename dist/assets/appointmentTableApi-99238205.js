import{r as x,j as t,M as R,u as Z,F as ee,P as te,Q as Y,c as g,f as ne,R as oe,B as U,d as J,S as ae,$ as se,g as T}from"./index-f3fd4875.js";import{U as re,C as le}from"./Checkbox-ca597904.js";import"./styles.module-60436982.js";import{e as ce}from"./utils-045dd2ef.js";import"./styles.module-eea2a584.js";import{M as ie}from"./Modal-4f6b9d89.js";import{D as de}from"./DatePicker-1844a6a5.js";import{l as ue}from"./lodash-81e24afa.js";import{u as E}from"./useMutation-131cfbe0.js";import{u as A}from"./useQuery-e978b944.js";import{C as me}from"./CardsNavigate-0d0882af.js";import{S as pe}from"./services-ico-c9ffa9f5.js";var q=(e=>(e.ALL="all",e.PERIODONTICS="4",e.THERAPY="5",e.SURGERY="6",e.ORTHOPEDICS="7",e.OTHER="1",e))(q||{});const he={1:"Другое",4:"Пародонтология",5:"Терапия",6:"Хирургия",7:"Ортопедия"},_e="_root_1modc_1",ke={root:_e},fe=x.memo(({templateId:e,onDeleteTemplate:a})=>t.jsxs(t.Fragment,{children:[t.jsx(R,{onClick:()=>!1,children:"Просмотр"}),t.jsx(R,{onClick:()=>!1,children:"Копировать"}),t.jsx(R,{onClick:()=>!1,children:"Копировать все"}),t.jsx(R,{onClick:()=>!1,children:"Вставить"}),t.jsx(R,{onClick:()=>!1,children:"Переименовать"}),t.jsx(R,{onClick:()=>a(e),children:"Удалить"})]}));function Mt({id:e,onNavigate:a}){const{data:s,refetch:r}=Tt({offset:0,limit:100,category:e===q.ALL?"":he[e]??""}),{mutate:c}=jt(),y=Z(),{checkUserRole:u}=ee(),h=u("superAdmin"),p=x.useMemo(()=>s!=null&&s.data.length?s.data.map(({id:k,name:w})=>({id:k,title:w??"",ico:t.jsx(pe,{}),link:te.template.preview(e,k==null?void 0:k.toString())})):[],[s]),v=k=>{k.preventDefault(),k.stopPropagation(),alert("onCopy")},C=({link:k,id:w})=>{if(u("superAdmin")){y(k);return}a&&a(w)},_=x.useCallback(k=>{c(k,{onSuccess:()=>{Y("Success!",{type:"success"}),r()},onError:w=>{Y(ce(w),{type:"error"})}})},[c]),b=x.useCallback(k=>t.jsx(fe,{templateId:k,onDeleteTemplate:_}),[_]);return t.jsx(me,{className:ke.root,cards:p,hasCopy:h,onCopy:v,onClick:C,menuItems:h?b:void 0})}const be="_modalContent_kcoom_1",Be="_headBlock_kcoom_1",ge="_inputBlock_kcoom_6",ye="_dropdownBlock_kcoom_15",ve="_dropdown_kcoom_15",Ce="_buttonBlock_kcoom_30",Ie="_modal_kcoom_1",Kt={modalContent:be,headBlock:Be,inputBlock:ge,dropdownBlock:ye,dropdown:ve,buttonBlock:Ce,modal:Ie},xe="_root_1kpbb_2",we="_selectItem_1kpbb_7",Te="_circle_1kpbb_16",je="_right_1kpbb_45",V={root:xe,selectItem:we,circle:Te,right:je};function z(e){const[a,s]=x.useState(!1),r=x.useRef(null),{children:c,preview:y,className:u,positionParams:h,onDelete:p,onEdit:v,onUpdate:C,parentRef:_}=e,[b,k]=x.useState({element:null,offsetX:0}),w=ue.debounce(l=>{C&&(r.current.style.marginLeft="0px",C({sizeX:l}))},100),S=x.useCallback(()=>{let l=0;if(_){const B=Array.from(_.children);if(B.length>1)return l=B.slice(0,-1).reduce((P,i)=>P+i.offsetWidth,0),((_==null?void 0:_.offsetWidth)||0)-l}return l},[_])(),I=l=>{if(r.current){const B=r.current.getBoundingClientRect(),P=l.clientX,i=r.current.offsetWidth,o=h.minWidth??80,f=P-B.left<=20,X=B.right-P<=20;if(f||X){const M=Q=>{const W=Q.clientX-P;let $;f&&W>0?($=Math.max(i-W,o),$>o&&(r.current.style.marginLeft=`${W}px`,w($))):X&&($=W<S?i+W:i+S),$&&$>o&&(r.current.style.width=`${$}px`,w($))},G=()=>{document.removeEventListener("mousemove",M),document.removeEventListener("mouseup",G)};document.addEventListener("mousemove",M),document.addEventListener("mouseup",G)}}},m=()=>{s(!0)},D=l=>{k(l)},O=l=>{var B;l.preventDefault(),D({element:l.currentTarget,offsetX:"clientX"in l?((B=r.current)==null?void 0:B.clientWidth)??0/2:0})},F=l=>{l.key==="Enter"?m():(l.key==="ContextMenu"||l.shiftKey&&l.key==="F10")&&O(l)},N=()=>{s(!1)},K=()=>{k({element:null,offsetX:0})},j={...(h==null?void 0:h.sizeX)&&{width:h.sizeX}};return y?t.jsx("div",{style:j,className:u,children:c}):t.jsxs("div",{className:V.root,style:j,children:[t.jsxs("div",{ref:r,onClick:m,tabIndex:0,onMouseDown:I,onBlur:N,onKeyDown:F,onContextMenu:O,role:"button",className:g(u,{[V.selectItem]:a}),children:[c,t.jsx("div",{className:V.right})]}),b.element&&t.jsxs(ne,{anchorEl:b.element,open:!!b.element,onClose:K,anchorPosition:{top:0,left:0},style:{marginLeft:b.offsetX/2,marginTop:-20},children:[v&&t.jsx(R,{onClick:()=>{v(),K()},children:"Редактировать"}),t.jsx(R,{onClick:()=>{p(),K()},children:"Удалить"})]})]})}const Ne="_defaultInput_1h9s2_2",Se="_selectItem_1h9s2_19",Oe="_createItem_1h9s2_20",Ee="_circle_1h9s2_29",ze="_right_1h9s2_63",Re="_lineContent_1h9s2_96",$e="_preview_1h9s2_103",De="_text_1h9s2_106",Pe="_bold_1h9s2_109",Le="_inputBlock_1h9s2_112",Fe="_marker_1h9s2_122",Xe="_radioButtonsBlock_1h9s2_128",Me="_radioBlock_1h9s2_128",Ke="_radioButton_1h9s2_128",We="_checked_1h9s2_137",Ae="_dropdown_1h9s2_154",Ue="_empty_1h9s2_162",Ve="_checkbox_1h9s2_166",He="_modalDropdown_1h9s2_173",Ge="_headBlock_1h9s2_173",Ye="_deleteButton_1h9s2_183",Je="_createVariable_1h9s2_194",qe="_createVariablePlus_1h9s2_202",Qe="_buttonBlock_1h9s2_213",Ze="_modal_1h9s2_173",n={defaultInput:Ne,selectItem:Se,createItem:Oe,circle:Ee,right:ze,lineContent:Re,preview:$e,text:De,bold:Pe,inputBlock:Le,marker:Fe,radioButtonsBlock:Xe,radioBlock:Me,radioButton:Ke,checked:We,dropdown:Ae,empty:Ue,checkbox:Ve,modalDropdown:He,headBlock:Ge,deleteButton:Ye,createVariable:Je,createVariablePlus:qe,buttonBlock:Qe,modal:Ze},Wt=oe.memo(e=>{const{onCurrentBlockInfo:a,onToggleVisibility:s,updateTemplatesLineItem:r,updateCurrentBlock:c}=et(),y=x.useRef(null),[u,h]=x.useState(""),[p,v]=x.useState(!1),[C,_]=x.useState(!1),[b,k]=x.useState([{id:0,value:-1,label:""}]),{subTemplateId:w,bodyBlockId:L,lineId:S,status:I,type:m="create",isEditValue:D=!1,value:O,handleChange:F,...N}=e,K=()=>{s(!0),a(w,L,S)},j=i=>{if(!D)return;const o={value:i.toString(),...I==="DROPDOWN"&&{value:JSON.stringify(b)},...I==="CHECK_BOX"&&{value:JSON.stringify({value:i.toString(),isChecked:p})}};h(i),c(w,L,S,o),F&&F({id:e.id??S,value:o.value})},l=()=>{r(w,L,S)},B=i=>{c(w,L,S,i)};x.useEffect(()=>{var i;if(O&&h(e.answer??O),O&&I==="DROPDOWN"){const o=JSON.parse(O??"");k(o);const f=e.answer&&JSON.parse(e.answer);h((f==null?void 0:f.value)??((i=o[0])==null?void 0:i.value))}if(O&&I==="CHECK_BOX"){const o=m!=="preview"?u:typeof u=="string"&&JSON.parse(e.answer||O||"{}");v(o.isChecked)}},[]),x.useEffect(()=>{if(I==="CHECK_BOX"){const i=JSON.parse(O||'{"value": ""}'),o={value:JSON.stringify({value:i.value,isChecked:p})};c(w,L,S,o),F&&F({id:e.id??S,value:o.value})}},[p]);const P=()=>{var i;switch(!0){case I==="TEXT":return t.jsx(z,{parentRef:e.parentRef,positionParams:N,preview:m==="preview",onUpdate:B,onDelete:l,className:g(n.lineContent,{[n.preview]:m==="preview"}),children:t.jsx("div",{className:n.inputBlock,children:t.jsx("input",{readOnly:m==="preview",className:g(n.defaultInput,n.text),value:u,onChange:o=>j(o.target.value)})})});case I==="BOLD_TEXT":return t.jsx(z,{parentRef:e.parentRef,positionParams:N,preview:m==="preview",onUpdate:B,onDelete:l,className:g(n.lineContent,{[n.preview]:m==="preview"}),children:t.jsx("div",{className:n.inputBlock,children:t.jsx("input",{readOnly:m==="preview",className:g(n.defaultInput,n.bold),value:u,onChange:o=>j(o.target.value)})})});case I==="POINT_TEXT":return t.jsx(z,{parentRef:e.parentRef,positionParams:N,preview:m==="preview",onUpdate:B,onDelete:l,className:g(n.lineContent,n.marker,{[n.preview]:m==="preview"}),children:t.jsx("div",{className:n.inputBlock,children:t.jsx("input",{readOnly:m==="preview",className:g(n.defaultInput),value:u,onChange:o=>j(o.target.value)})})});case I==="DROPDOWN":return t.jsx(z,{parentRef:e.parentRef,positionParams:{...N,minWidth:90},onUpdate:B,preview:m==="preview",onEdit:()=>_(!0),onDelete:l,className:g(n.lineContent,{[n.preview]:m==="preview"}),children:t.jsx(ae,{value:u||-1,onChange:o=>j(o.target.value),className:n.dropdown,selectNavigate:!0,selectOptions:b,children:b.map(({label:o,value:f})=>t.jsx(R,{value:f,className:"select-link",children:o},f))})});case I==="CHECK_BOX":{let o="";if(m!=="preview"&&!D)o=u;else if(typeof u=="string")try{o=((i=JSON.parse(u))==null?void 0:i.value)??""}catch{o=u}return t.jsx(z,{parentRef:e.parentRef,positionParams:N,onUpdate:B,preview:m==="preview",onDelete:l,className:g(n.lineContent,{[n.preview]:m==="preview"}),children:t.jsx(le,{className:n.checkbox,checked:p,onChange:()=>D&&v(f=>!f),children:t.jsx("input",{readOnly:m==="preview",placeholder:"Ваше значение",className:g(n.defaultInput,n.text),value:o,onChange:f=>j(f.target.value)})})})}case I==="RADIO_BOX":return t.jsx(z,{parentRef:e.parentRef,positionParams:{...N,minWidth:170},onUpdate:B,preview:m==="preview",onDelete:l,className:g(n.lineContent,n.radioButtonsBlock,{[n.preview]:m==="preview"}),children:t.jsxs(t.Fragment,{children:[t.jsxs("button",{type:"button",onClick:()=>j("Yes"),className:g(n.lineContent,n.radioBlock),children:[t.jsx("span",{className:g(n.radioButton,{[n.checked]:u==="Yes"})}),"Да"]}),t.jsxs("button",{type:"button",onClick:()=>j("No"),className:g(n.lineContent,n.radioBlock),children:[t.jsx("span",{className:g(n.radioButton,{[n.checked]:u!=="Yes"})}),"Нет"]})]})});case I==="DATE":return t.jsx(z,{parentRef:e.parentRef,positionParams:{...N,minWidth:170},onUpdate:B,preview:m==="preview",onDelete:l,className:g(n.lineContent,{[n.preview]:m==="preview"}),children:t.jsx(de,{sx:{".MuiInputBase-root.MuiOutlinedInput-root":{width:"150px",height:"42px",padding:"0 20px",maxWidth:"none",background:"#CBECFF",borderRadius:"10px",border:"1px solid #0E5F8C",fontSize:"14px",color:"#0E5F8C"},".MuiInputBase-root .MuiButtonBase-root.MuiIconButton-root":{color:"#0E5F8C"}},value:J(u),onChange:o=>o&&j(J(o).toISOString()),readOnly:!D})});case I==="EMPTY":return t.jsx(z,{parentRef:e.parentRef,positionParams:N,onUpdate:B,preview:m==="preview",onDelete:l,className:g(n.lineContent,n.empty),children:t.jsx("p",{children:m==="create"?"Пустое место":""})});case I==="WRITE_TEXT":return t.jsx(z,{parentRef:e.parentRef,positionParams:{...N,minWidth:200},onUpdate:B,preview:m==="preview",onDelete:l,className:g(n.lineContent),children:t.jsx(re,{value:u.toString(),name:"",onChange:o=>typeof o=="object"?j(o.target.value):"",readOnly:!D})});default:return t.jsxs("div",{ref:y,onClick:K,tabIndex:0,onKeyDown:()=>!1,role:"button",className:g(n.lineContent,n.createItem),children:[t.jsx("div",{className:n.circle,children:" + "}),t.jsx("div",{className:n.right})]})}};return t.jsxs(t.Fragment,{children:[P(),t.jsx(ie,{isOpen:C,type:"custom",onSuccess:()=>_(!1),onClose:()=>_(!1),className:n.modal,children:t.jsxs("div",{className:n.modalDropdown,children:[t.jsx("div",{className:n.headBlock,children:"Дропдаун"}),b.map(({id:i})=>{var o;return t.jsxs("div",{className:n.inputBlock,children:[t.jsx("input",{value:(o=b.find(({id:f})=>i===f))==null?void 0:o.label,onChange:f=>k(X=>X.map(M=>i===M.id?{...M,label:f.target.value}:M)),type:"text",placeholder:b.length===1?"Первый вариант по умолчанию":"Введите вариант"}),t.jsx("button",{type:"button",className:n.deleteButton,disabled:b.length===1,onClick:()=>k(f=>f.filter(({id:X})=>i!==X)),children:"x"})]},i)}),t.jsxs(U,{className:n.createVariable,onClick:()=>k(i=>[...i,{id:i.length+1,value:i.length+1,label:""}]),type:"button",color:"primary-reverse",children:[t.jsx("div",{className:n.createVariablePlus,children:"+"}),"Создать вариант"]}),t.jsxs("div",{className:n.buttonBlock,children:[t.jsx(U,{className:n.submit,type:"submit",color:"secondary",onClick:()=>{l(),_(!1)},children:"Назад"}),t.jsx(U,{className:n.submit,type:"submit",color:"primary",onClick:()=>{B({value:JSON.stringify(b)}),_(!1)},children:"Сохранить"})]})]})})]})}),H=(e,a,s)=>{e(r=>({templates:r.templates.map(c=>c.subTemplateId===a?s(c):c)}))},et=se((e,a)=>({toggleVisibility:!1,selectTemplateItem:"",currentBlockInfo:null,templates:[{name:"",positionId:0,subTemplateId:0,lineBlocks:[{positionId:0,bodyBlockId:0,blockInfo:[]}]}],handleTemplatesTitle:(s,r)=>{e(c=>({templates:c.templates.map(y=>y.subTemplateId===s?{...y,name:r}:y)}))},addTemplatesLine:s=>{H(e,s,r=>{const c=r.lineBlocks.length,y={positionId:c,bodyBlockId:c,blockInfo:[]};return{...r,lineBlocks:[...r.lineBlocks,y]}})},updateTemplatesLine:(s,r)=>{H(e,s,c=>({...c,lineBlocks:r}))},onToggleVisibility:s=>{e({toggleVisibility:s,currentBlockInfo:null})},handleTemplates:s=>{e({templates:s})},onCurrentBlockInfo:(s,r,c)=>{e({currentBlockInfo:{subTemplateId:s,bodyBlockId:r,lineId:c}})},updateTemplatesLineItem:(s,r,c)=>{const{templates:y}=a(),u=y.map(h=>{if(h.subTemplateId!==s)return h;const p=h.lineBlocks.map(v=>{if(v.bodyBlockId!==r)return v;const C=v.blockInfo.filter(({lineId:_})=>_!==c);return{...v,blockInfo:C}});return{...h,lineBlocks:p}});e({templates:u})},addCurrentBlock:s=>{const{currentBlockInfo:r}=a();if(!r)return;const{subTemplateId:c,bodyBlockId:y,lineId:u}=r;H(e,c,h=>({...h,lineBlocks:h.lineBlocks.map(p=>{if(p.bodyBlockId===y){if(p.blockInfo.length===0)return{...p,blockInfo:[{lineId:0,positionId:0,sizeX:0,sizeY:0,space:0,status:s,value:""},{lineId:1,positionId:1,sizeX:0,sizeY:0,space:0,status:"default",value:""}]};const v=p.blockInfo.length+2;return{...p,blockInfo:[...p.blockInfo.map(C=>{if(C.lineId===u){const _=p.blockInfo.length+1;return{lineId:_,positionId:_,sizeX:0,sizeY:0,space:0,status:s,value:""}}return C}),{lineId:v,positionId:v,sizeX:0,sizeY:0,space:0,status:"default",value:""}]}}return p})})),e({toggleVisibility:!1,currentBlockInfo:null})},updateCurrentBlock:(s,r,c,y)=>{const{templates:u}=a(),h=u.map(p=>{if(p.subTemplateId!==s)return p;const v=p.lineBlocks.map(C=>{if(C.bodyBlockId!==r)return C;const _=C.blockInfo.map(b=>b.lineId===c?{...b,...y}:b);return{...C,blockInfo:_}});return{...p,lineBlocks:v}});e({templates:h})}})),tt="_wrapper_k08z0_2",nt="_draggable_k08z0_8",ot="_headBlock_k08z0_19",at="_blockWithPadding_k08z0_20",st="_defaultInput_k08z0_30",rt="_dragHandleLeft_k08z0_47",lt="_contentBlockDraggable_k08z0_48",ct="_dragHandleRight_k08z0_59",it="_show_k08z0_73",dt="_createLineBlock_k08z0_77",ut="_createLine_k08z0_77",mt="_text_k08z0_92",pt="_contentBlock_k08z0_48",ht="_lineContent_k08z0_105",_t="_bold_k08z0_116",kt="_list_k08z0_119",ft="_inputBlock_k08z0_119",bt="_radioBlock_k08z0_125",Bt="_radioButton_k08z0_125",gt="_checked_k08z0_134",yt="_dropdown_k08z0_151",vt="_empty_k08z0_159",Ct="_selectItem_k08z0_163",It="_createItem_k08z0_164",xt="_circle_k08z0_173",wt="_right_k08z0_207",At={wrapper:tt,draggable:nt,headBlock:ot,blockWithPadding:at,defaultInput:st,dragHandleLeft:rt,contentBlockDraggable:lt,dragHandleRight:ct,show:it,createLineBlock:dt,createLine:ut,text:mt,contentBlock:pt,lineContent:ht,bold:_t,list:kt,inputBlock:ft,radioBlock:bt,radioButton:Bt,checked:gt,dropdown:yt,empty:vt,selectItem:Ct,createItem:It,circle:xt,right:wt},d={root:["appointment-table"],templateGetAll:e=>[...d.root,`template-get-all-${e}`],deleteTemplate:()=>[...d.root,"template-delete-template"],deleteSubTemplate:()=>[...d.root,"template-delete-sub-template"],deleteBodyBlock:()=>[...d.root,"template-delete-body-block"],templateGetOne:e=>[...d.root,`template-get-one-${e}`],templateUpdate:()=>[...d.root,"template-template-update"],createUpdateBodyBlock:()=>[...d.root,"create-update-body-block"],createTemplate:()=>[...d.root,"create-template"],createSubTemplate:()=>[...d.root,"create-sub-template"],treatment:(e,a)=>[...d.root,`treatment-treatment-get-${e}-${a}`],treatmentId:()=>[...d.root,"treatment-treatment-get-by-id"],treatmentCreate:()=>[...d.root,"treatment-treatment-create"],treatmentUpdate:()=>[...d.root,"treatment-treatment-update"],treatmentAnswerCreate:()=>[...d.root,"treatment-answer-create"]};function Ut(){return E({mutationKey:d.createUpdateBodyBlock(),mutationFn:async e=>(await T({url:"/template/create-update-body-block",method:"POST",data:e})).data})}function Vt(){return E({mutationKey:d.createTemplate(),mutationFn:async e=>(await T({url:"/template/create-template",method:"POST",data:e})).data})}function Ht(){return E({mutationKey:d.createSubTemplate(),mutationFn:async e=>(await T({url:"/template/create-sub-template",method:"POST",data:e})).data})}function Gt(){return E({mutationKey:d.templateUpdate(),mutationFn:async e=>(await T({url:"/template/update-template",method:"POST",data:e})).data})}function Yt(e=""){return A({queryKey:d.templateGetOne(e),queryFn:async()=>(await T({url:`/template/get-one/${e}`,method:"GET"})).data,enabled:!!e})}function Tt({offset:e,limit:a,category:s}){return A({queryKey:d.templateGetAll(s),queryFn:async()=>(await T({url:"/template/get-all",method:"GET",params:{offset:e,limit:a,category:s}})).data})}function jt(){return E({mutationKey:d.deleteTemplate(),mutationFn:async e=>(await T({url:`/template/delete-template/${e}`,method:"DELETE"})).data})}function Jt(){return E({mutationKey:d.deleteSubTemplate(),mutationFn:async e=>(await T({url:`/template/delete-sub-template/${e}`,method:"DELETE"})).data})}function qt(){return E({mutationKey:d.deleteBodyBlock(),mutationFn:async e=>(await T({url:`/template/delete-body-block/${e}`,method:"POST"})).data})}function Qt(e){return A({queryKey:d.treatment(e.patientId,e.category??""),queryFn:async()=>(await T({url:"/treatment/treatment-get",method:"GET",params:e})).data})}function Zt(e){return A({queryKey:d.treatmentId(),queryFn:async()=>{const a=await T({url:`/treatment/treatment-get-by-id/${e}`,method:"GET"});return a==null?void 0:a.data[0]}})}function en(){return E({mutationKey:d.treatmentCreate(),mutationFn:async e=>(await T({url:"/treatment/treatment-create",method:"POST",data:e})).data})}function tn(){return E({mutationKey:d.treatmentCreate(),mutationFn:async e=>(await T({url:"/treatment/treatment-update",method:"POST",data:e})).data})}function nn(){return E({mutationKey:d.treatmentCreate(),mutationFn:async e=>(await T({url:"/treatment/answer-create",method:"POST",data:e})).data})}export{Wt as C,he as R,Mt as T,Ht as a,Gt as b,Jt as c,jt as d,Ut as e,qt as f,et as g,Zt as h,nn as i,tn as j,Vt as k,en as l,q as m,At as n,Tt as o,Qt as p,Kt as s,Yt as u};
