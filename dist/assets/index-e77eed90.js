import{r as b,j as e,c as n,S as I,M as F,B as g,d as T,Q as j,a as O}from"./index-fa80df68.js";import{b as N,c as s}from"./styles.module-f0edd1c7.js";import{c as B,a as v}from"./index.esm-68c64567.js";import"./styles.module-eea2a584.js";import"./styles.module-47d05e94.js";/* empty css               */import{a as P,b as W,F as C,E as _}from"./formik.esm-f9c5b2d0.js";import{b as R}from"./doctorApi-7d9d8576.js";import{W as w,a as $}from"./WorkDay-98426e82.js";import{d as q,t as H}from"./times-768f0984.js";import{e as S}from"./utils-045dd2ef.js";import{D as V}from"./DatePicker-ccbcad4d.js";import{g as L}from"./helpers-96bd5b30.js";import{d as Q,e as z}from"./patientsApi-8ab9cda6.js";import"./styles.module-2ab3757a.js";import"./styles.module-6cec8057.js";import{B as A}from"./BackButton-7ca9a21c.js";import"./useQuery-229aca3d.js";import"./useBaseQuery-e8d907b8.js";import"./close-gray-ico-004632ab.js";import"./styles.module-749ea44e.js";import"./extendSxProp-ac3efb2b.js";import"./Typography-03a50c65.js";import"./hooks-80c184ed.js";import"./useMutation-d5f6a419.js";import"./styles.module-4a1edd24.js";function k(d){const{title:u,selectOptions:o,value:m,onChange:p,className:h}=d,f=l=>{const i=o.find(({value:x})=>x===l.target.value);i&&p(i)};return b.useEffect(()=>{p(o[0])},[]),e.jsxs("div",{className:n(N.root,h),children:[e.jsx("span",{className:N.label,children:u}),e.jsx(I,{value:m??0,onChange:f,className:n("form-input",N.selectTime),selectNavigate:!0,defaultOption:o[0].label,selectOptions:o,children:o.map(({label:l,value:i})=>e.jsx(F,{value:i,className:"select-link",children:l},i))})]})}function G({patientId:d}){const[u,o]=b.useState(null),{data:m}=R(),{mutate:p}=Q(),{mutate:h}=z(),f=b.useMemo(()=>{const a={value:-1,label:"Имя врача"},r=m==null?void 0:m.map(({id:c,fullName:t})=>({value:c,label:t}));return r!=null&&r.length?[a,...r]:[a]},[m]),l=L(),i=async(a,{setSubmitting:r})=>{const[c,t]=a.startTime.split(":").map(Number),[D,M]=a.endTime.split(":").map(Number);p({...a,startTime:T(u).hour(c).minute(t).toISOString(),endTime:T(u).hour(D).minute(M).toISOString()},{onSuccess:()=>{j("Success!",{type:"success"})},onSettled:()=>{r(!1)},onError:E=>{j(S(E),{type:"error"})}})},x=()=>{h("id",{onSuccess:()=>{},onError:a=>{j(S(a),{type:"error"})}})};return e.jsx(P,{initialValues:{patientId:d,userId:"",startTime:"",endTime:"",notice:"",servicePrices:[{}]},validationSchema:B().shape({userId:v().required(),startTime:v().required(),endTime:v().required()}),onSubmit:i,children:({isSubmitting:a,values:r,setFieldValue:c})=>e.jsxs(W,{className:n(s.container,"full-width"),children:[e.jsx("div",{className:s.label,children:"Имя врача"}),e.jsx(C,{name:"userId",className:"form-input",children:t=>e.jsx(I,{...t,className:n(s.select,"form-input"),selectOptions:f})}),!!r.userId&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s.label,children:"График приема"}),e.jsxs("div",{className:s.dateWork,children:[e.jsx(V,{value:u,className:s.datePicker,onChange:t=>o(t)}),e.jsx(w,{daysWork:q,handleChange:()=>!1,className:s.workDay})]}),e.jsx($,{className:s.workTime,timesWork:H,handleChange:()=>!1}),e.jsxs("div",{className:s.times,children:[e.jsx(k,{title:"Время от",value:r.startTime,onChange:t=>c("startTime",t.value),selectOptions:l}),e.jsx(k,{title:"Время до",value:r.endTime,onChange:t=>c("endTime",t.value),selectOptions:l})]}),e.jsxs("fieldset",{className:n(s.complaint,"full-width"),children:[e.jsx("div",{className:s.label,children:"Жалоба"}),e.jsx(C,{name:"notice",className:n(s.complaintField,"form-textarea"),type:"text",placeholder:"Заметка",component:"textarea"}),e.jsx(_,{name:"notice"})]}),e.jsxs("div",{className:s.submitting,children:[e.jsx(g,{color:"primary-reverse",className:s.delete,onClick:()=>x(),children:"Удалить запись"}),e.jsx(g,{className:n(s.submit,"form-submit"),type:"submit",color:"secondary",disabled:a,children:"Применить"})]})]})]})})}const J="_root_1dr9s_1",K="_formContainer_1dr9s_5",y={root:J,formContainer:K};function Te(){const d=O();return e.jsxs("div",{className:y.root,children:[e.jsx(A,{title:"Записать пациента на прием"}),e.jsx("div",{className:y.formContainer,children:e.jsx(G,{patientId:d.patientId})})]})}export{Te as default};
