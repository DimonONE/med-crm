import{a as D,r as c,u as V,j as s,S as b,c as d,M as g,B as k,Q as f,P as M}from"./index-f3fd4875.js";import{a as R}from"./doctorApi-a90abfc1.js";import{U as y}from"./Checkbox-ca597904.js";import{h as G,u as H,i as J,C as U}from"./appointmentTableApi-99238205.js";import{e as L}from"./utils-045dd2ef.js";import"./styles.module-eea2a584.js";import{B as Q}from"./BackButton-00ebe5a5.js";import{F as W}from"./FileLoader-8687942d.js";import{T as q}from"./TechInfo-a8da95c6.js";import"./useQuery-e978b944.js";import"./useBaseQuery-588bdd2f.js";import"./styles.module-60436982.js";import"./Typography-cf2be92b.js";import"./extendSxProp-6285f959.js";import"./Modal-4f6b9d89.js";import"./DatePicker-1844a6a5.js";/* empty css               */import"./Popper-7c78b30a.js";import"./lodash-81e24afa.js";import"./useMutation-131cfbe0.js";import"./CardsNavigate-0d0882af.js";import"./styles.module-6aece55b.js";import"./services-ico-c9ffa9f5.js";import"./styles.module-4a1edd24.js";import"./close-gray-ico-0519171e.js";import"./styles.module-f9591ad8.js";const z="_root_yma46_1",K="_backButton_yma46_6",X="_draggable_yma46_11",Y="_headBlock_yma46_24",Z="_lineBlock_yma46_28",$="_itemBlock_yma46_32",ee="_visitSummary_yma46_36",se="_name_yma46_45",ae="_visitSummaryText_yma46_49",te="_container_yma46_53",le="_statusBlock_yma46_60",oe="_submitBlock_yma46_61",ie="_selectTemplate_yma46_67",me="_submit_yma46_61",ce="_save_yma46_91",t={root:z,backButton:K,draggable:X,headBlock:Y,lineBlock:Z,itemBlock:$,visitSummary:ee,name:se,visitSummaryText:ae,container:te,statusBlock:le,submitBlock:oe,selectTemplate:ie,submit:me,save:ce};function Fe(){const n=D(),[S,B]=c.useState(1),[p,T]=c.useState(void 0),[o,I]=c.useState({completed:"",comment:"",plan:"",files:void 0}),C=V(),[v,N]=c.useState(void 0),[u,w]=c.useState([]),{data:_}=G(n.treatmentId),{data:m}=H(n.id),{data:x}=R(n.patientId),{mutate:E}=J(),j=[{value:1,label:"В процессе",type:"ACTIVE"},{value:2,label:"Закончено",type:"END"}],r=c.useMemo(()=>(m==null?void 0:m.subTemplates.map(({id:e,name:a})=>({value:e,label:a})))??[],[m]),P=({id:e,value:a})=>{const i=u.some(l=>l.id===e)?u.map(l=>l.id===e?{...l,answer:a}:l):[...u,{id:e,answer:a}];w(i)},A=()=>{const e=m==null?void 0:m.subTemplates.find(({id:a})=>a===v);T(e)},O=()=>{var i;if(Object.values(o).some(l=>l==="")){f("Краткое резюме посещения обязательно к заполнению!",{type:"warning"});return}if(!x)throw new Error("recordsPatient of undefined");const e=(i=x[x.length-1])==null?void 0:i.id;console.log("answers",u);const a={recordId:e,treatmentId:Number(n.treatmentId),subTemplateId:Number(v),completed:o.completed,comment:o.comment,plan:o.plan,blocks:JSON.stringify(u),...o!=null&&o.files?{files:o.files}:{}};E(a,{onSuccess:async l=>{const F=JSON.parse(l.data);console.log("/treatment/answer-create",F),f("Success!",{type:"success"}),C(M.reception.info(n.patientId,n.doctorId))},onSettled:()=>{},onError:l=>{f(L(l),{type:"error"})}})},h=(e,a)=>{I(i=>({...i,[e]:a}))};return c.useEffect(()=>{var e;N((e=r[0])==null?void 0:e.value)},[r]),s.jsxs("div",{className:t.root,children:[s.jsx(Q,{title:"Создание приема",link:"",className:t.backButton}),s.jsxs("div",{className:t.container,children:[s.jsxs("div",{className:t.statusBlock,children:[s.jsx("span",{children:"Статус лечения"}),s.jsx(b,{value:S,onChange:e=>{var a;return B((a=e==null?void 0:e.target)==null?void 0:a.value)},className:d("form-input buttons-header",t.selectTemplate),selectNavigate:!0,selectOptions:j,children:j.map(({label:e,value:a})=>s.jsx(g,{value:a,className:"select-link",children:e},a))})]}),s.jsx("div",{children:s.jsx(q,{techInfo:{fullName:_==null?void 0:_.patient.fullName,cardNumber:"",info:(m==null?void 0:m.techInfo)??""}})}),s.jsxs("div",{className:t.submitBlock,children:[r.length?s.jsx(b,{value:v??r[0].value,onChange:e=>{var a;return N((a=e==null?void 0:e.target)==null?void 0:a.value)},className:d("form-input buttons-header",t.selectTemplate),selectNavigate:!0,selectOptions:r,children:r.map(({label:e,value:a})=>s.jsx(g,{value:a,className:"select-link",onClick:()=>!1,children:e},a))}):null,s.jsx(k,{className:d(t.selectTemplate,t.submit),onClick:A,children:"Создать прием"})]}),p==null?void 0:p.bodyBlocks.sort((e,a)=>e.id-a.id).map(e=>s.jsxs("div",{className:d(t.draggable),children:[s.jsx("div",{className:t.headBlock,children:e.name}),s.jsx("div",{className:d(t.blockWithPadding,t.lineBlock),children:e.lineBlocks.map(a=>s.jsx("div",{className:t.itemBlock,children:a.blocks.map(i=>s.jsx("div",{children:c.createElement(U,{...i,key:i.lineId,type:"preview",isEditValue:!0,subTemplateId:e.subTemplateId,bodyBlockId:a.id,status:i.status,handleChange:l=>P(l)})},i.id))},a.id))})]},e.id)),p&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:d(t.draggable),children:[s.jsx("div",{className:t.headBlock,children:"Краткое резюме посещения "}),s.jsxs("div",{className:t.visitSummary,children:[s.jsx("li",{className:t.name,children:"План: "}),s.jsx(y,{value:o.plan,name:"",onChange:e=>typeof e=="object"?h("plan",e.target.value):!1,className:t.visitSummaryText})]}),s.jsxs("div",{className:t.visitSummary,children:[s.jsx("li",{className:t.name,children:"Выполнили: "}),s.jsx(y,{value:o.completed,name:"",onChange:e=>typeof e=="object"?h("completed",e.target.value):!1,className:t.visitSummaryText})]}),s.jsxs("div",{className:t.visitSummary,children:[s.jsx("li",{className:t.name,children:"Комментарий: "}),s.jsx(y,{value:o.comment,name:"",onChange:e=>typeof e=="object"?h("comment",e.target.value):!1,className:t.visitSummaryText})]}),s.jsx("div",{className:t.visitSummary,children:s.jsx(W,{id:"pdf-files",title:"Загрузить",onChange:e=>h("files",e),onDownload:()=>{},onDelete:()=>{},className:t.visitSummaryFiles})})]}),s.jsx(k,{className:t.save,onClick:O,children:"Сохранить"})]})]})]})}export{Fe as default};
