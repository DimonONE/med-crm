import{k as x,r as u,d as n,j as e,c as S,R as E,u as L,b as V,Q as P,e as D,B as M,P as Y}from"./index-28b8728f.js";import{T as R,a as H,I as K,b as $,c as C,d as r,e as U}from"./index.es-b4da052e.js";import{u as G}from"./hooks-9171095e.js";import{u as O}from"./useMutation-267c9319.js";import{g as W}from"./styles.module-6fbcb23a.js";import{T as q,d as Q}from"./times-5f17a510.js";import{e as z}from"./utils-045dd2ef.js";import{S as w}from"./arrow-bottom-filter-ed2c8b82.js";const o={root:["staff-attendance"],listOfAttendance:()=>[...o.root,"list-of-attendance"],createWorkTime:()=>[...o.root,"create-work-time"],createVisits:()=>[...o.root,"create-visits"],createVacation:()=>[...o.root,"create-vacation"]},J=async a=>(await x({url:"/users/work-list",method:"GET",params:a})).data;function xe(a){return G({queryKey:o.listOfAttendance(),fetchPage:J,initialQuery:a})}function Te(){return O({mutationKey:o.createWorkTime(),mutationFn:async a=>(await x({url:"/users/create-work-time",method:"POST",data:a})).data})}function je(){return O({mutationKey:o.createVacation(),mutationFn:async a=>(await x({url:"/users/create-vacation",method:"POST",data:a})).data})}function X(){return O({mutationKey:o.createVisits(),mutationFn:async a=>(await x({url:"/users/create-visits",method:"POST",data:a})).data})}const Z="_dayOff_135p2_1",ee="_vacations_135p2_8",g={dayOff:Z,vacations:ee};function te({id:a,vacations:l,workTimes:T,defaultTimeValue:y,handleChange:m}){const[j,c]=u.useState(!0),f=l.find(s=>n().isBetween(n(s.startTime),n(s.endTime),null,"[]")),h=T.filter(s=>s.dayOfWeek===n().format("dddd")),k=h.length===0;if(u.useEffect(()=>{c(!1)},[]),f){const s=n(f.startTime).format("DD.MM.YYYY"),v=n(f.endTime).format("DD.MM.YYYY");return e.jsx("div",{className:S(g.dayOff,g.vacations),children:`ОТПУСК: ${s} - ${v}`})}if(k)return e.jsx("div",{className:g.dayOff,children:"ВЫХОДНОЙ"});const _=s=>{j||y.length===s.length||m(s)};return e.jsx(q,{id:a,defaultTimeValue:y,startTime:W(9),endTime:W(20),workTimes:h,handleChange:_})}const ae="_days_1cdrt_1",se="_day_1cdrt_1",ne="_active_1cdrt_18",re="_tableCellItem_1cdrt_22",ce="_workTime_1cdrt_29",d={days:ae,day:se,active:ne,tableCellItem:re,workTime:ce},ke=E.forwardRef((a,l)=>{const T=L(),[,y]=V(),[m,j]=u.useState(void 0),[c,f]=u.useState(null),{personnelList:h,dataLength:k,hasNextPage:_,handleUpdateFilters:s,handleFetchNextPage:v,onScroll:A}=a,{mutate:B}=X(),I=t=>{j(i=>i===t?null:t)};return u.useEffect(()=>{c&&(c==null?void 0:c.times.length)>0&&B({userId:c.userId,date:n().toISOString(),times:c.times},{onSuccess:()=>{P("Success!",{type:"success"})},onError:t=>{P(z(t),{type:"error"})}})},[c]),u.useEffect(()=>{const t={fieldBySort:m!==null?m:void 0};if(m!==void 0){const i=new URLSearchParams;Object.entries(t).forEach(([N,b])=>{b!=null&&i.set(N,b)}),y(i)}s(t)},[m]),h.length?e.jsx("div",{className:S(d.root,"container"),children:e.jsx(R,{id:"all-attendance-table",ref:l,onScroll:A,className:"table-container",component:D,children:e.jsx(H,{sx:{minWidth:850},"aria-label":"simple table",children:e.jsxs(K,{scrollableTarget:"all-attendance-table",next:v,hasMore:_||!1,loader:null,dataLength:k,children:[e.jsx($,{children:e.jsxs(C,{children:[e.jsx(r,{width:"100%",className:"table-head-cell",children:"СЕГОДНЯШНИЙ ДЕНЬ"}),e.jsx(r,{style:{minWidth:"240px"},className:"table-head-cell",children:"ТЕКУЩАЯ НЕДЕЛЯ"}),e.jsx(r,{style:{minWidth:"140px"},className:"table-head-cell",onClick:()=>I("totalWeek"),children:e.jsxs("span",{className:d.tableCellItem,children:["Часы нед",e.jsx(w,{})]})}),e.jsx(r,{style:{minWidth:"140px"},className:"table-head-cell",onClick:()=>I("totalMonth"),children:e.jsxs("span",{className:d.tableCellItem,children:["Часы мес",e.jsx(w,{})]})}),e.jsx(r,{className:"table-head-cell",children:"НАСТРОИТЬ"})]})}),e.jsx(U,{children:h.map(t=>e.jsxs(C,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(r,{className:"table-body-cell",component:"th",scope:"row",children:e.jsx(te,{id:t.userId,vacations:t.vacations,workTimes:t.workTimes,defaultTimeValue:t.visits,handleChange:i=>f({userId:t.userId,times:i})})}),e.jsx(r,{className:"table-body-cell",component:"th",scope:"row",children:e.jsx("div",{className:d.days,children:Q.map(({id:i,day:N})=>{const F=t.vacations.some(p=>n().isBetween(n(p.startTime),n(p.endTime),null,"[]"))?!0:t.workTimes.every(p=>p.dayOfWeek!==n().day(i).format("dddd"));return e.jsx("span",{className:S(d.day,{[d.active]:!F}),children:N},i)})})}),e.jsx(r,{className:"table-body-cell",align:"left",children:Number(t.timeWeek).toFixed(1)}),e.jsx(r,{className:"table-body-cell",align:"left",children:Number(t.timeMonth).toFixed(1)}),e.jsx(r,{className:"table-body-cell",children:e.jsx(M,{className:d.buttonLink,color:"secondary",onClick:()=>T(Y.attendance.schedule(t.userId)),children:"Настроить"})})]},t.timeWeek))})]})})})}):null}),ie="_vacationTime_18ytm_1",oe="_datePickerBlock_18ytm_9",le="_submit_18ytm_18",_e={vacationTime:ie,datePickerBlock:oe,submit:le};export{ke as A,je as a,Te as b,_e as s,xe as u};
