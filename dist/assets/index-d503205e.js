import{r as h,j as e,B as f,c as N,Q as d,u as E,N as F,P as _,S as q,a as B}from"./index-edd193da.js";import{b as k,c as w,d as A,e as M,f as $,g as H,h as v,i as b,a as T}from"./styles.module-050b641d.js";import{u as U,E as t,F as i,a as G,b as O}from"./formik.esm-d06b19e8.js";import{c as Q,a as c}from"./index.esm-521cd8d8.js";import{e as y}from"./utils-045dd2ef.js";import{B as R}from"./BackButton-c80bf77c.js";/* empty css               */import"./styles.module-eea2a584.js";import"./hooks-c2e677eb.js";import"./useBaseQuery-623edf0b.js";import"./useQuery-156e574e.js";import"./useMutation-0ceeb9ec.js";import"./styles.module-4a1edd24.js";function V({userId:a}){const{mutate:o}=k(),[p,n]=h.useState(!1),x=U({name:"password"}),j=async()=>{o({password:x[0].value,userId:a},{onSuccess:({data:s})=>{s.message==="success"&&(d("Success!",{type:"success"}),n(!1))},onError:s=>{d(y(s),{type:"error"})}})};return e.jsxs("div",{children:[!p&&e.jsx(f,{className:N("form-submit"),color:"secondary",onClick:()=>n(!0),children:"Изменить пароль"}),p&&e.jsxs("div",{className:w.editPassword,children:[e.jsxs("fieldset",{children:[e.jsx("div",{className:"error-message",children:e.jsx(t,{name:"password"})}),e.jsx(i,{name:"password",className:"form-input",type:"text",placeholder:"Пароль"})]}),e.jsx(f,{className:N(w.submitPassword,"form-submit"),color:"primary",type:"submit",onClick:j,children:"Применить"})]})]})}function z({clinicId:a,isCreate:o}){var g;const p=E(),{data:n}=A(),{mutate:x}=M(),{mutate:j}=$(),s=H(),S=h.useMemo(()=>{const r={value:-1,label:"Выберите тип клиники"};if(n){const l=n.map(m=>({value:m.name,label:m.name}));return[r,...l]}return[r]},[n]),P=async(r,{setSubmitting:l,resetForm:m})=>{try{!o&&(s!=null&&s.id)?await j({...r,userId:s.id},{onSuccess:u=>{T(u),d("Success!",{type:"success"}),m()},onError:u=>{d(y(u),{type:"error"})}}):"password"in r&&await x(r,{onSuccess:()=>{d("Success!",{type:"success"}),m()},onError:u=>{d(y(u),{type:"error"})}})}finally{l(!1)}};return h.useEffect(()=>(o&&s&&(p(0),v()),function(){v()}),[s,o]),a&&!s?e.jsx(F,{to:_.superAdmin.selectClinic(a)}):e.jsx(G,{initialValues:{email:(s==null?void 0:s.email)??"",fullName:(s==null?void 0:s.fullName)??"",password:"",address:(s==null?void 0:s.clinic.address)??"",country:(s==null?void 0:s.clinic.country)??"",city:(s==null?void 0:s.clinic.city)??"",description:(s==null?void 0:s.clinic.description)??"",name:(s==null?void 0:s.clinic.name)??"",phone:(s==null?void 0:s.phone)??"",type:(g=s==null?void 0:s.clinic.type)==null?void 0:g.name},validationSchema:Q().shape({fullName:c().min(3).required(),name:c().min(3).required(),email:c().email().required(),password:c().test({name:"password",message:"Password is required for creating",test(r){return o?!!r:!0}}).min(8),type:c().test({name:"type",message:"Selected type",test(r){return!!r}}),phone:c().required()}),onSubmit:(r,l)=>P(r,l),children:({isSubmitting:r})=>e.jsxs(O,{className:b.form,children:[e.jsxs("fieldset",{disabled:r,children:[e.jsxs("fieldset",{className:"full-width",children:[e.jsx("div",{className:"error-message",children:e.jsx(t,{name:"name"})}),e.jsx(i,{name:"name",className:"form-input",type:"text",placeholder:"Название клиники"})]}),e.jsx("fieldset",{className:"full-width",children:e.jsx(i,{name:"type",className:"form-input",placeholder:"Тип клиники",children:l=>{var m;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"error-message",children:(m=l.form.errors)==null?void 0:m.type}),e.jsx(q,{...l,className:"form-input",selectOptions:S})]})}})}),e.jsxs("fieldset",{className:"full-width",children:[e.jsx("div",{className:"error-message",children:e.jsx(t,{name:"address"})}),e.jsx(i,{name:"address",className:"form-input",type:"text",placeholder:"Адрес"})]}),e.jsxs("fieldset",{children:[e.jsx("div",{className:"error-message",children:e.jsx(t,{name:"country"})}),e.jsx(i,{name:"country",className:"form-input",type:"text",placeholder:"Страна"}),e.jsx(t,{name:"country"})]}),e.jsxs("fieldset",{children:[e.jsx("div",{className:"error-message",children:e.jsx(t,{name:"city"})}),e.jsx(i,{name:"city",className:"form-input form-input-text",type:"text",placeholder:"Город"})]}),e.jsxs("fieldset",{children:[e.jsx("div",{className:"error-message",children:e.jsx(t,{name:"phone"})}),e.jsx(i,{name:"phone",className:"form-input",type:"text",placeholder:"+7 (000) - 00 - 00"})]}),e.jsxs("fieldset",{children:[e.jsx("div",{className:"error-message",children:e.jsx(t,{name:"email"})}),e.jsx(i,{name:"email",className:"form-input",type:"text",placeholder:"Почта"})]}),o&&e.jsxs("fieldset",{children:[e.jsx("div",{className:"error-message",children:e.jsx(t,{name:"password"})}),e.jsx(i,{name:"password",className:"form-input",type:"text",placeholder:"Пароль"})]}),e.jsxs("fieldset",{children:[e.jsx("div",{className:"error-message",children:e.jsx(t,{name:"fullName"})}),e.jsx(i,{name:"fullName",className:"form-input",type:"text",placeholder:"Имя главврача"})]}),e.jsxs("fieldset",{className:"full-width",children:[e.jsx("div",{className:"form-textarea-label",children:"Краткое описание"}),e.jsx(i,{name:"description",className:"form-textarea",type:"text",placeholder:"Коментарий...",component:"textarea"}),e.jsx("div",{className:"error-message",children:e.jsx(t,{name:"description"})})]})]}),(s==null?void 0:s.id)&&e.jsx(V,{userId:s.id}),e.jsx(f,{className:N(b.submit,"form-submit"),type:"submit",color:"primary",disabled:r,children:a?"Сохранить":"Создать"})]})})}const D="_root_1no0o_1",J="_formContainer_1no0o_6",C={root:D,formContainer:J};function le(){const a=B();return e.jsxs("div",{className:C.root,children:[e.jsx(R,{title:a!=null&&a.clinicId?"Редактировать клинику":"Добавить клинику"}),e.jsx("div",{className:C.formContainer,children:e.jsx(z,{clinicId:a!=null&&a.clinicId?Number(a.clinicId):void 0,isCreate:!(a!=null&&a.clinicId)})})]})}export{le as default};
