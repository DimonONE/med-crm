import{a as F,r as i,j as s,S as b,c as d,M as g,B as S,Q as f}from"./index-28b8728f.js";import{a as P}from"./doctorApi-6ee17efe.js";import{U as y}from"./Checkbox-aa482c20.js";import{f as D,u as V,g as M,C as R}from"./appointmentTableApi-e27f7e8c.js";import{e as J}from"./utils-045dd2ef.js";import"./styles.module-eea2a584.js";import{B as U}from"./BackButton-03403362.js";import{F as G}from"./FileLoader-a4bb3fb1.js";import{T as H}from"./TechInfo-3aec2ce0.js";import"./useQuery-5e80a04e.js";import"./useBaseQuery-d5b5de49.js";import"./styles.module-60436982.js";import"./Typography-37f7fd1d.js";import"./extendSxProp-3260528d.js";import"./Modal-25888893.js";import"./DatePicker-abb74157.js";/* empty css               */import"./Popper-0206d46a.js";import"./lodash-f37d900b.js";import"./useMutation-267c9319.js";import"./CardsNavigate-bcbe1f7e.js";import"./styles.module-6aece55b.js";import"./services-ico-9fbacd7d.js";import"./styles.module-4a1edd24.js";import"./close-gray-ico-ce01fa8c.js";import"./styles.module-f9591ad8.js";const L="_root_yma46_1",Q="_backButton_yma46_6",q="_draggable_yma46_11",z="_headBlock_yma46_24",K="_lineBlock_yma46_28",W="_itemBlock_yma46_32",X="_visitSummary_yma46_36",Y="_name_yma46_45",Z="_visitSummaryText_yma46_49",$="_container_yma46_53",ee="_statusBlock_yma46_60",se="_submitBlock_yma46_61",te="_selectTemplate_yma46_67",ae="_submit_yma46_61",le="_save_yma46_91",a={root:L,backButton:Q,draggable:q,headBlock:z,lineBlock:K,itemBlock:W,visitSummary:X,name:Y,visitSummaryText:Z,container:$,statusBlock:ee,submitBlock:se,selectTemplate:te,submit:ae,save:le};function Ee(){const u=F(),[k,B]=i.useState(1),[p,T]=i.useState(void 0),[m,I]=i.useState({completed:"",comment:"",plan:"",files:void 0}),[v,j]=i.useState(void 0),[r,C]=i.useState([]),{data:_}=D(u.treatmentId),{data:c}=V(u.id),{data:x}=P(u.patientId),{mutate:w}=M(),N=[{value:1,label:"В процессе",type:"ACTIVE"},{value:2,label:"Закончено",type:"END"}],n=i.useMemo(()=>(c==null?void 0:c.subTemplates.map(({id:e,name:t})=>({value:e,label:t})))??[],[c]),E=({id:e,value:t})=>{const o=r.some(l=>l.id===e)?r.map(l=>l.id===e?{...l,answer:t}:l):[...r,{id:e,answer:t}];C(o)},O=()=>{const e=c==null?void 0:c.subTemplates.find(({id:t})=>t===v);T(e)},A=()=>{var o;if(Object.values(m).some(l=>l==="")){f("Краткое резюме посещения обязательно к заполнению!",{type:"warning"});return}if(!x)throw new Error("recordsPatient of undefined");const e=(o=x[x.length-1])==null?void 0:o.id;console.log("answers",r);const t={recordId:e,treatmentId:Number(u.treatmentId),subTemplateId:Number(v),completed:m.completed,comment:m.comment,plan:m.plan,blocks:JSON.stringify(r),...m!=null&&m.files?{files:m.files}:{}};w(t,{onSuccess:async l=>{console.log("/treatment/answer-create",JSON.parse(l.data)),f("Success!",{type:"success"})},onSettled:()=>{},onError:l=>{f(J(l),{type:"error"})}})},h=(e,t)=>{I(o=>({...o,[e]:t}))};return i.useEffect(()=>{var e;j((e=n[0])==null?void 0:e.value)},[n]),s.jsxs("div",{className:a.root,children:[s.jsx(U,{title:"Создание приема",link:"",className:a.backButton}),s.jsxs("div",{className:a.container,children:[s.jsxs("div",{className:a.statusBlock,children:[s.jsx("span",{children:"Статус лечения"}),s.jsx(b,{value:k,onChange:e=>{var t;return B((t=e==null?void 0:e.target)==null?void 0:t.value)},className:d("form-input buttons-header",a.selectTemplate),selectNavigate:!0,selectOptions:N,children:N.map(({label:e,value:t})=>s.jsx(g,{value:t,className:"select-link",children:e},t))})]}),s.jsx("div",{children:s.jsx(H,{techInfo:{fullName:_==null?void 0:_.patient.fullName,cardNumber:"",info:(c==null?void 0:c.techInfo)??""}})}),s.jsxs("div",{className:a.submitBlock,children:[n.length?s.jsx(b,{value:v??n[0].value,onChange:e=>{var t;return j((t=e==null?void 0:e.target)==null?void 0:t.value)},className:d("form-input buttons-header",a.selectTemplate),selectNavigate:!0,selectOptions:n,children:n.map(({label:e,value:t})=>s.jsx(g,{value:t,className:"select-link",onClick:()=>!1,children:e},t))}):null,s.jsx(S,{className:d(a.selectTemplate,a.submit),onClick:O,children:"Создать прием"})]}),p==null?void 0:p.bodyBlocks.map(e=>s.jsxs("div",{className:d(a.draggable),children:[s.jsx("div",{className:a.headBlock,children:e.name}),e.lineBlocks.map(t=>s.jsx("div",{className:a.itemBlock,children:t.blocks.map(o=>s.jsx("div",{children:i.createElement(R,{...o,key:o.lineId,type:"preview",isEditValue:!0,subTemplateId:e.subTemplateId,bodyBlockId:t.id,status:o.status,handleChange:l=>E(l)})},o.id))},t.id))]},e.id)),p&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:d(a.draggable),children:[s.jsx("div",{className:a.headBlock,children:"Краткое резюме посещения"}),s.jsxs("div",{className:a.visitSummary,children:[s.jsx("li",{className:a.name,children:"План: "}),s.jsx(y,{value:m.plan,name:"",onChange:e=>typeof e=="object"?h("plan",e.target.value):!1,className:a.visitSummaryText})]}),s.jsxs("div",{className:a.visitSummary,children:[s.jsx("li",{className:a.name,children:"Выполнили: "}),s.jsx(y,{value:m.completed,name:"",onChange:e=>typeof e=="object"?h("completed",e.target.value):!1,className:a.visitSummaryText})]}),s.jsxs("div",{className:a.visitSummary,children:[s.jsx("li",{className:a.name,children:"Комментарий: "}),s.jsx(y,{value:m.comment,name:"",onChange:e=>typeof e=="object"?h("comment",e.target.value):!1,className:a.visitSummaryText})]}),s.jsx("div",{className:a.visitSummary,children:s.jsx(G,{id:"pdf-files",title:"Загрузить",onChange:e=>h("files",e),onDownload:()=>{},onDelete:()=>{},className:a.visitSummaryFiles})})]}),s.jsx(S,{className:a.save,onClick:A,children:"Сохранить"})]})]})]})}export{Ee as default};
